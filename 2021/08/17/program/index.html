<!DOCTYPE html><html lang="zh_CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>项目总结 | 野菜</title><meta name="keywords" content="项目总结"><meta name="author" content="野菜"><meta name="copyright" content="野菜"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="项目总结"><meta name="application-name" content="项目总结"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="项目总结"><meta property="og:url" content="http://example.com/2021/08/17/program/index.html"><meta property="og:site_name" content="野菜"><meta property="og:description" content="项目介绍1. 项目流程 需求分析（评审和分析) 等视觉与交互设计 项目开发（项目完成度基本与视觉设计和交互设计保持一致） 预留充分的自测时间（测试功能和样式） 前后端联调（调接口功能与字段限制）；经常需要改接口逻辑、甚至加接口造成前端需要修改对应的校验或功能；时间必须 视觉与交互验收 产品验收 提交"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="//img.mp.itc.cn/upload/20160518/f260fbc2a76f45319924b1a884a37cf3_th.jpg"><meta property="article:author" content="野菜"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="//img.mp.itc.cn/upload/20160518/f260fbc2a76f45319924b1a884a37cf3_th.jpg"><meta name="description" content="项目介绍1. 项目流程 需求分析（评审和分析) 等视觉与交互设计 项目开发（项目完成度基本与视觉设计和交互设计保持一致） 预留充分的自测时间（测试功能和样式） 前后端联调（调接口功能与字段限制）；经常需要改接口逻辑、甚至加接口造成前端需要修改对应的校验或功能；时间必须 视觉与交互验收 产品验收 提交"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://example.com/2021/08/17/program/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2024/07/27/125766904/ba62475f396df9de3316a08ed9e65d86_5680958632268053399..png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: {"apiurl":"https://friends.anheyu.com/"},
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🤖️ 数码科技爱好者","🔍 分享与热心帮助","🏠 智能家居小能手","🔨 设计开发一条龙","🤝 专修交互与设计","🏃 脚踏实地行动派","🧱 团队小组发动机","💢 壮汉人狠话不多"]},
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: 野菜","link":"链接: ","source":"来源: 野菜","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: '野菜',
  title: '项目总结',
  postAI: '',
  pageFillDescription: '项目介绍, 1. 项目流程, 2. 项目迭代, 3. 联调, 项目难点和亮点, 1.  权限管理, 1.1 登录权限, 1.2 页面权限, 第一种：前端处理, 第二种：后端返回路由表, 1.3  内容权限按钮权限控制, 2. 上传图片, 1. 前端, 2. 后端, 配置文件, 路由文件, 3. 封装的公共组件, 3.1 Vue, 3.1.1 二次封装, 1. el-image 二次封装, 3.1.2 初始造轮子, 1. 模态框, 3.2 React, 1. 全局dialog, 3.2.1 高阶组件, 4. 封装的工具函数, 4.1 自定义hooks, 1. useSessionStorage, 2. useList, 4.2 自定义指令, 4.3 封装插件, 1. 全局try catch, 5. 封装的高阶组件, 5.1 权限控制, 5.2 页面复用, 3. 统一处理 loading, 4. 路由鉴权, 项目性能优化, 一、 登陆, 1. 登陆处理流程, 1.1 token 处理, 1.2 手机验证码登陆, 2. token生成(服务器生成)：, 3. token 验证, 4. token 的使用, 5. 前端处理 token, 5.1 保存 token, 5.2 请求携带, 5.3 未登录处理, 二、 项目错误, 1. Axios统一错误处理, 2. Vue统一错误处理, 3. React 统一错误处理, 4. 全局捕获错误处理, 三、 两万条数据如何处理, 四、 版本管理, 五、 流量大接口多如何处理, 六、excel 导入导出, 配置文件, 使用, 七、 定时器问题, 八、 gzip压缩, 九、实时通讯, 1. Websocket, 2. 短轮询, 3. 长轮询, 十、浏览器的Devtool的使用, 元素面板 Elements, 网络面板 Network, 性能面板 Performance, 控制台面板 Console, 源代码面板 Sources, 内存面板 Memory, 应用面板 Application项目介绍项目流程需求分析评审和分析等视觉与交互设计项目开发项目完成度基本与视觉设计和交互设计保持一致预留充分的自测时间测试功能和样式前后端联调调接口功能与字段限制经常需要改接口逻辑甚至加接口造成前端需要修改对应的校验或功能时间必须视觉与交互验收产品验收提交测试线上接口回归新项目的上线前准备资源申请沙盒环境部署测试线上部署测试项目迭代需求分析系统设计代码实现系统测试联调本地模拟假数据使用数据项目难点和亮点权限管理登录权限概述登录权限控制要做的事情是实现哪些页面能被游客访问哪些页面只有登录后才能被访问路由守卫登录拦截表示用户登录的凭证如果路由中的字段下的为表示该路由必须登录后访问存在表示已经登陆了那么想干嘛干嘛去不存在表明你没有登录不好意思回到登录页如果跳转需要携带参数就把参数也传递过去不需要登录就可以访问直接下一步页面权限第一种前端处理概述根据不同的角色赋予其不同的页面访问权限用户登陆成功之后后端返回用户信息然后保存在和里面张三从里面拿到当前用户的权限列表然后遍历动态路由数组从里面过滤出允许访问的路由最后将这些路由动态添加到路由实例里从中拿到用户信息用户已经登录从用户信息中获取权限列表过滤允许访问的路由将允许访问的路由动态添加到路由栈中嵌套子路由接受两个参数第一个参数对应父路由的属性第二个参数是要添加的子路由信息问题当超级管理员登录后退出路由实例任然存在导致普通用户也能访问解决当用户选择登出后清除掉路由实例里面处存放的路由栈信息获取路由实例登出函数将整个路由栈清空获取所有路由信息获取路由名词移除路由生成新的路由栈跳转到登录页面第二种后端返回路由表动态创建菜单创建动态创建菜单判断是否需要在菜单中显示当前菜单项动态创建路由树状转扁平自定义转树状动态加载组件处理后路由转树状处理后路由在文件中内容权限按钮权限控制概述不同的角色都能进入页面但要求看到的页面内容不一样按照增删查改四个维度对页面内容进行归类使用简称来标识分别代表创建更新读取和删除后端返回用户列表张三权限编码权限编码设置全局自定义指令当元素挂载完毕后通过获取该元素要求的权限编码然后拿到当前路由名称通过路由名称可以在中获取到该用户在该页面所拥有的权限编码如果该用户不具备访问该元素的权限就把元素移除创建的根实例获取权限值获取当前路由名称当前用户拥有的权限不拥有该权限移除元素页面中使用修改删除发布需求列表页上传图片前端必须与后端一致请求路径文件上传成功文件上传失败取消文件上传将文件拖拽到此处或点击上传后端配置文件文件上传函数配置存储位置前提必须保证该目录存在存储地址配置文件名上传文件可以获取前端传递的图片名及其后缀比如数组最后一位数组长度长度后缀名随机名字上传图片时约定的字段名必须上传后对图片重新命名路由文件引入配置文件上传文件该字段必须与前段一致封装的公共组件二次封装二次封装概述组件我们需要统一在图片加载失败的时候展示的特定图技术点的妙用是在创建更高级别的组件在封装第三方组件时可以自动将在父作用域中使用的的属性自动绑定并向下传入被封装的使用了的组件的作用它可以将父作用域中的使用的时间监听器向下传入到使用了组件中和组件中和的功效类似只不过一个属性一个是事件使用事例图片加载失败加载中初始造轮子模态框创建一个文件实现基本的结构和样式标题通过传入设置为必传按钮默认一个确认按钮可定制可显示取消按钮可定制主体通过插槽处理弹窗组件开关由外部控制但并不用来控制而是对进行监听赋值给组件内部变量方便组件内部控制弹窗的隐藏保证弹窗的层级足够高且弹窗内容的层级要比遮罩层的高后弹窗的层级高于之前的层级点击遮罩层关闭弹窗和处理弹窗地步页面的的内容不可滚动只在当前元素触发不从内部触发标题弹窗的主题内容按钮弹窗组件是否显示默认不显示必传属性取消确定禁止页面滚动每次获取之后自动增加取消按钮操作确认按钮操作点击遮罩关闭弹窗恢复页面的滚动弹窗动画最外层设置定位遮罩设置背景层值要足够大确保能覆盖高度宽度设置满做到全屏遮罩内容层要比遮罩大否则会被遮盖移动端使用布局使用新标题知道了关闭主题内容主题内容控制两个弹窗组件的初始显示与隐藏全局提示动画组件设置为目标组件打开弹窗关闭弹窗遍历所有子组件给子组件绑定给子组件也绑定一个关闭弹窗的事件高阶组件封装的工具函数自定义如果为则删除该键请求当前页数一页多少条数据查询参数是否自动请求默认自动请求获取数据错误自定义指令封装插件全局思路借助抽象语法树遍历查找代码中的关键字找到节点后从父路径中查找声明的函数获取该函数的函数中包含的代码创建语句将原来的放入其中最后将的替换成创建的语句封装的高阶组件权限控制概述利用高阶组件的条件渲染特性可以对页面进行权限控制您没有权限查看该页面请联系管理员页面复用统一处理公共逻辑处理统一处理高阶组件接受组件的路由鉴权重定向登录页并且记录想要访问的页面项目性能优化一登陆概述访问资源时所需要的凭证登陆处理流程处理前端通过发送账号和密码或账号和验证码给到后端后后端验证通过会返回一个唯一的作为该用户的登录凭证前端将此凭证存储在以及本地中在之后的每个请求当中请求头中都需带上这个作为后端的登录校验有过期的机制可以在请求拦截中做逻辑判断处理若当前时间接近了过期时间则通过更新的接口请求更新在之后的请求中带上新的以此循环若用户过长时间无操作则可认为用户为离线状态在用户之后的第一次请求时由于已经过期访问后端接口会发生错误根据后端返回的错误状态码作为判断将系统定向至登录页面通过带有请求头的请求方法后端可以判断到是哪一个用户前端也可以通过获取权限接口获得该用户的权限列表根据权限列表做一份路由映射表如果后端返回的数据结构与前端的路由设置的数据结构不同此时还需编写此映射路由的业务功能函数如果该用户拥有此路由权限则通过在全局路由监控中进行中的方法将有权限的路由配置添加到路由当中侧边栏也可根据路由列表中的字段中关键字的判断进行相应的渲染如果权限的颗粒度小到一个按钮则可根据后端返回的权限列表映射出的权限参数通过进行判断该功能组件是否渲染在路由管理中通过钩子中判断当前的路由权限是否为空是的话则可执行获取权限路由的接口手机验证码登陆前端点击发送验证码把手机号传给后端后端深沉随机数然后把号码以及短信内容包括随机数一起发送给第三方平台短信发送成功的会调里把手机号和随机数存到数据库用户收到短信点登陆后前端手机手机号和验证码传给后端和数据库进行对比验证成果就返回登陆成功和用户信息生成服务器生成利用模块该模块提供生成验证一般使用替代服务器端安装载荷密钥载荷为一个对象可以写任何非敏感信息密钥是一个包含算法的密钥或者密钥对在验证的时候也需要用到加密算法默认过期时间验证利用模块的使用使用拦截路由验证是否合法与生成的密钥相同与生成的加密算法一致路由白名单以下路由不受验证可以直接写路径也可以是正则匹配如果没有通过需要做错误处理这里响应状态吗表示无权限访问前端处理保存登陆之后获取并保存在本地登陆请求成功本地缓存请求错误请求携带获取获取将放在请求头该请求头由前后端约定但是后端使用就已经约束字段并且值以开头未登录处理响应成功先在这里接收到服务器响应范围内的状态码都会触发该函数对响应数据做点什么对后端返回的数据过滤直将返回给页面超出范围的状态码都会触发该函数对响应错误做点什么表示未登录或者登录过期第一步移除第二步重定向登录页二项目错误统一错误处理对网络请求的响应进行统一处理出错了统一错误处理使用全局的出错了此处省略其他配置统一错误处理先打印出来更新使下一次渲染能够显示降级后的你同样可以将错误日志上报给服务器后打印出来你可以自定义降级后的并渲染全局捕获错误处理处理事件对象获取到的的原因内容与控制台报错一致获取到未处理的对象三两万条数据如何处理使用虚拟滚动条后端进行分页当每次下滑到一定的像素的时候发送请求获取到下一页的数据四版本管理自动打包五流量大接口多如何处理缓存预渲染通过脚本平台白名单等等在上一个页面中预渲染下一个页面的数据六导入导出引入依赖主函数对数据进行过滤使用数组的方法接受一个函数作为参数函数接受四个参数若没有设置初始值则第一个参数为计算结束的返回值若有初始值则为初始值第二个参数为当前元素第三个参数为当前元素的索引常用于累加和累乘生成工作簿对象再将工作簿转化为对象接着创建标签利用标签的属性进行下载文件然后将工作簿对象转化为我们需要的首先生成的配置项然后将字符串转化为最后进行转码操作配置文件主函数形参注释注释表头类型结构姓名年龄地址注释导出数据类型注释自定义导出文件名类型主函数数据过滤生成数组将中的每一项遍历给重新赋值生成工作簿对象数组方法第一个参数为回调函数第二个参数为初始值回调函数接受两个参数第一个为累积变量第二个为每一项生成头部对应值将工作簿对象转化为对象创建标签利用标签的属性进行下载文件创建地址新增的属性指定保存文件名可以不要后缀注意模式下不会生效将工作簿对象转化为我们需要的生成的配置项字符串转要生成的文件类型是否生成官方解释是如果开启生成速度会下降但在低版本设备上有更好的兼容性转码操作使用导出导出是否确认导出采购申请表异步无法清空或者重新请求数据导出请选择导出列表七定时器问题概述我在页面写一个定时让他每秒钟打印一个然后跳转到页面此时可以看到定时器依然在执行这样是非常消耗性能的解决该方法是通过这个事件侦听器器在定义完定时器之后的位置来清除定时器某些定时器操作通过来监听定时器在钩子可以被清除八压缩这种单页应用首屏由于一次性加载所有资源所有首屏加载速度很慢解决这个问题非常有效的手段之一就是前后端开启其他还有缓存路由懒加载等等下载插件然后在中开启其他代码不开启开启其他代码九实时通讯概述是提供的一种浏览器与服务器进行全双工通讯的网络技术属于应用层协议它基于传输协议并复用的握手通道浏览器和服务器只需要完成一次握手两者之间就直接可以创建持久性的连接并进行双向数据传输作用服务器可以向客户端主动推动消息客户端也可以主动向服务器推送消息原理客户端向服务器通知一个带有所有接收者的事件服务器接收后立即通知所有活跃的客户端只有在接收者序列中的客户端才会处理这个事件使用服务端客户端已连接获取客户端收到客户端发送的消息已连接客户端我是服务端向当前客户端发送消息连接出错客户端断开客户端连接上客户端开启收到服务端消息收到消息断开连接关闭连接出错出错短轮询概述浏览器每隔一段时间向浏览器发送请求服务器端在收到请求后不论是否有数据更新都直接进行响应长轮询概述首先由客户端向服务器发起请求当服务器收到客户端发来的请求后服务器端不会直接进行响应而是先将这个请求挂起然后判断服务器端数据是否有更新如果有更新则进行响应如果一直没有数据则到达一定的时间限制才返回十浏览器的的使用元素面板能在元素面板查看选择当前页的树能够实时的修改和调试可以再每行代码前面右键添加断点属性改变子节点改变节点删除可以右键选择节点的状态等等网络面板与后端调试接口时有时候会重新请求一次或者阻断请求查看请求参数和请求到的数据性能面板在这个面板你可以录制一段操作然后查看录制期间的一些页面性能信息录制前有几个选项可选包括网络环境模拟速度模拟是否开启录制期间截屏控制台面板打印输出调试观察数据结构源代码面板可以看到一些原文件和代码类似元素面板中设置断点这里也可以在每一行代码前设置断点利用这些断点使代码运行到适当的时候或位置停下来以便查看特定时刻的变量值调用堆栈样式等内存面板在此面板录制可以使用分析器识别开销大的函数分析器准确地记录调用了哪些函数和每个函数花费的时间也可以将配置文件可视化为火焰图执行比较卡的时候可以用这个工具来查找原因应用面板查看和修改与并可查看',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-11-06 10:25:24',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">野菜</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a><div id="he-plugin-simple"></div><script>var WIDGET = {
  "CONFIG": {
    "modules": "0124",
    "background": "2",
    "tmpColor": "FFFFFF",
    "tmpSize": "16",
    "cityColor": "FFFFFF",
    "citySize": "16",
    "aqiColor": "E8D87B",
    "aqiSize": "16",
    "weatherIconSize": "24",
    "alertIconSize": "18",
    "padding": "10px 10px 10px 10px",
    "shadow": "0",
    "language": "auto",
    "borderRadius": "20",
    "fixed": "true",
    "vertical": "top",
    "horizontal": "left",
    "left": "20",
    "top": "7.1",
    "key": "df245676fb434a0691ead1c63341cd94"
  }
}
</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"/><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size: 0.9em;"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 小空调</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AJAX/" style="font-size: 1.05rem;">AJAX<sup>1</sup></a><a href="/tags/Axios/" style="font-size: 1.05rem;">Axios<sup>1</sup></a><a href="/tags/CSS/" style="font-size: 1.05rem;">CSS<sup>1</sup></a><a href="/tags/Git/" style="font-size: 1.05rem;">Git<sup>1</sup></a><a href="/tags/HTML/" style="font-size: 1.05rem;">HTML<sup>1</sup></a><a href="/tags/MySQL/" style="font-size: 1.05rem;">MySQL<sup>1</sup></a><a href="/tags/Node-js/" style="font-size: 1.05rem;">Node.js<sup>1</sup></a><a href="/tags/React/" style="font-size: 1.05rem;">React<sup>1</sup></a><a href="/tags/TypeScript/" style="font-size: 1.05rem;">TypeScript<sup>1</sup></a><a href="/tags/Vue/" style="font-size: 1.05rem;">Vue<sup>3</sup></a><a href="/tags/Vue3/" style="font-size: 1.05rem;">Vue3<sup>1</sup></a><a href="/tags/canvas/" style="font-size: 1.05rem;">canvas<sup>1</sup></a><a href="/tags/host/" style="font-size: 1.05rem;">host<sup>1</sup></a><a href="/tags/js/" style="font-size: 1.05rem;">js<sup>3</sup></a><a href="/tags/this/" style="font-size: 1.05rem;">this<sup>1</sup></a><a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 1.05rem;">前端<sup>3</sup></a><a href="/tags/%E5%8D%9A%E5%AE%A2/" style="font-size: 1.05rem;">博客<sup>1</sup></a><a href="/tags/%E6%8C%87%E4%BB%A4/" style="font-size: 1.05rem;">指令<sup>1</sup></a><a href="/tags/%E6%95%99%E7%A8%8B/" style="font-size: 1.05rem;">教程<sup>1</sup></a><a href="/tags/%E6%A1%86%E6%9E%B6/" style="font-size: 1.05rem;">框架<sup>1</sup></a><a href="/tags/%E7%AC%94%E8%AE%B0/" style="font-size: 1.05rem;">笔记<sup>3</sup></a><a href="/tags/%E7%B3%BB%E7%BB%9F/" style="font-size: 1.05rem;">系统<sup>4</sup></a><a href="/tags/%E7%BC%96%E7%A8%8B/" style="font-size: 1.05rem;">编程<sup>12</sup></a><a href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" style="font-size: 1.05rem;">面试题<sup>1</sup></a><a href="/tags/%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/" style="font-size: 1.05rem;">项目总结<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/11/"><span class="card-archive-list-date">十一月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/10/"><span class="card-archive-list-date">十月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">6</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">六月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/04/"><span class="card-archive-list-date">四月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/03/"><span class="card-archive-list-date">三月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/01/"><span class="card-archive-list-date">一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/04/"><span class="card-archive-list-date">四月 2022</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/11/"><span class="card-archive-list-date">十一月 2021</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/" itemprop="url">项目总结</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>项目总结</span></a></span></div></div><h1 class="post-title" itemprop="name headline">项目总结</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2021-08-17T08:00:00.000Z" title="发表于 2021-08-17 16:00:00">2021-08-17</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-11-06T02:25:24.989Z" title="更新于 2025-11-06 10:25:24">2025-11-06</time></span></div><div class="meta-secondline"><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为长沙"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>长沙</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="//img.mp.itc.cn/upload/20160518/f260fbc2a76f45319924b1a884a37cf3_th.jpg"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://example.com/2021/08/17/program/"><header><a class="post-meta-categories" href="/categories/%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/" itemprop="url">项目总结</a><a href="/tags/%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/" tabindex="-1" itemprop="url">项目总结</a><h1 id="CrawlerTitle" itemprop="name headline">项目总结</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">野菜</span><time itemprop="dateCreated datePublished" datetime="2021-08-17T08:00:00.000Z" title="发表于 2021-08-17 16:00:00">2021-08-17</time><time itemprop="dateCreated datePublished" datetime="2025-11-06T02:25:24.989Z" title="更新于 2025-11-06 10:25:24">2025-11-06</time></header><h2 id="项目介绍"><a href="#项目介绍" class="headerlink" title="项目介绍"></a>项目介绍</h2><h3 id="1-项目流程"><a href="#1-项目流程" class="headerlink" title="1. 项目流程"></a>1. 项目流程</h3><ul>
<li>需求分析（评审和分析)</li>
<li>等视觉与交互设计</li>
<li>项目开发（项目完成度基本与视觉设计和交互设计保持一致）</li>
<li>预留充分的自测时间（测试功能和样式）</li>
<li>前后端联调（调接口功能与字段限制）；经常需要改接口逻辑、甚至加接口造成前端需要修改对应的校验或功能；时间必须</li>
<li>视觉与交互验收</li>
<li>产品验收</li>
<li>提交测试</li>
<li>线上接口回归</li>
<li>新项目的上线前准备<ul>
<li>资源申请</li>
<li>沙盒环境部署测试</li>
<li>线上部署测试</li>
</ul>
</li>
</ul>
<h3 id="2-项目迭代"><a href="#2-项目迭代" class="headerlink" title="2. 项目迭代"></a>2. 项目迭代</h3><p> 需求分析、系统设计、代码实现、系统测试。 </p>
<h3 id="3-联调"><a href="#3-联调" class="headerlink" title="3. 联调"></a>3. 联调</h3><p>本地模拟假数据，使用mock数据 </p>
<h2 id="项目难点和亮点"><a href="#项目难点和亮点" class="headerlink" title="项目难点和亮点"></a>项目难点和亮点</h2><h3 id="1-权限管理"><a href="#1-权限管理" class="headerlink" title="1.  权限管理"></a>1.  权限管理</h3><h4 id="1-1-登录权限"><a href="#1-1-登录权限" class="headerlink" title="1.1 登录权限"></a>1.1 登录权限</h4><p>概述： 登录权限控制要做的事情,是实现哪些页面能被游客访问,哪些页面只有登录后才能被访问. </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 路由守卫 - 登录拦截</span></span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> token = store.<span class="property">state</span>.<span class="property">token</span>; <span class="comment">// 表示用户登录的凭证</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (to.<span class="property">meta</span>.<span class="property">auth</span>) &#123;</span><br><span class="line">    <span class="comment">// 如果路由中的 meta 字段下的 auth 为true，表示该路由必须登录后访问</span></span><br><span class="line">    <span class="keyword">if</span> (token) &#123;</span><br><span class="line">      <span class="comment">// token 存在，表示已经登陆了，那么想干嘛干嘛去</span></span><br><span class="line">      <span class="title function_">next</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> next_page = to.<span class="property">name</span></span><br><span class="line">      <span class="comment">// 不存在，表明你没有登录，不好意思，回到登录页</span></span><br><span class="line">      <span class="title function_">next</span>(&#123;</span><br><span class="line">          <span class="attr">name</span>:<span class="string">&#x27;login&#x27;</span>,</span><br><span class="line">          <span class="attr">params</span>:&#123;</span><br><span class="line">              redirect_page : next_page ,</span><br><span class="line">              ...form.<span class="property">params</span>   <span class="comment">//如果跳转需要携带参数就把参数也传递过去</span></span><br><span class="line">          &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 不需要登录就可以访问</span></span><br><span class="line">    <span class="title function_">next</span>(); <span class="comment">// 直接下一步</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="1-2-页面权限"><a href="#1-2-页面权限" class="headerlink" title="1.2 页面权限"></a>1.2 页面权限</h4><h5 id="第一种：前端处理"><a href="#第一种：前端处理" class="headerlink" title="第一种：前端处理"></a>第一种：前端处理</h5><p>概述：根据不同的角色赋予其不同的页面访问权限</p>
<ul>
<li>用户登陆成功之后，后端返回用户信息，然后保存在<code>vuex</code>和<code>localStorage</code>里面</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">user_id</span>:<span class="number">1</span>,</span><br><span class="line">  <span class="attr">user_name</span>:<span class="string">&quot;张三&quot;</span>,</span><br><span class="line">  <span class="attr">permission_list</span>:[<span class="string">&quot;List&quot;</span>,<span class="string">&quot;Detail&quot;</span>,<span class="string">&quot;Manage&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>从<code>vuex</code>里面拿到当前用户的权限列表,然后遍历动态路由数组<code>dynamic_routes</code>,从里面过滤出允许访问的路由,最后将这些路由动态添加到路由实例里.</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(store.<span class="property">state</span>.<span class="property">user</span> != <span class="literal">null</span>)&#123; <span class="comment">//从vuex中拿到用户信息</span></span><br><span class="line">    <span class="comment">//用户已经登录</span></span><br><span class="line">    <span class="keyword">const</span> &#123; permission_list &#125; = store.<span class="property">state</span>.<span class="property">user</span>; <span class="comment">// 从用户信息中获取权限列表</span></span><br><span class="line">    <span class="keyword">const</span> allow_routes = dynamic_routes.<span class="title function_">filter</span>(<span class="function">(<span class="params">route</span>)=&gt;</span>&#123; <span class="comment">//过滤允许访问的路由</span></span><br><span class="line">      <span class="keyword">return</span> permission_list.<span class="title function_">includes</span>(route.<span class="property">name</span>); </span><br><span class="line">    &#125;)</span><br><span class="line">    allow_routes.<span class="title function_">forEach</span>(<span class="function">(<span class="params">route</span>)=&gt;</span>&#123; <span class="comment">// 将允许访问的路由动态添加到路由栈中</span></span><br><span class="line">      router.<span class="title function_">addRoute</span>(route);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>嵌套子路由  <code>router.addRoute</code>接受两个参数,第一个参数对应父路由的<code>name</code>属性,第二个参数是要添加的子路由信息. </p>
</li>
<li><pre><code class="js">router.addRoute(&quot;Tabs&quot;, &#123;
        path: &quot;/list&quot;,
        name: &quot;List&quot;,
        component: List,
 &#125;);
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">问题：当超级管理员登录后退出，路由实例任然存在，导致普通用户也能访问</span><br><span class="line"></span><br><span class="line">解决： 当用户选择登出后,清除掉路由实例里面处存放的路由栈信息 </span><br><span class="line"></span><br><span class="line">```js</span><br><span class="line">const router = useRouter(); // 获取路由实例</span><br><span class="line">const logOut = () =&gt; &#123; //登出函数</span><br><span class="line">    //将整个路由栈清空</span><br><span class="line">    const old_routes = router.getRoutes();//获取所有路由信息</span><br><span class="line">    old_routes.forEach((item) =&gt; &#123;</span><br><span class="line">        const name = item.name;//获取路由名词</span><br><span class="line">        router.removeRoute(name); //移除路由</span><br><span class="line">    &#125;);</span><br><span class="line">    //生成新的路由栈</span><br><span class="line">    routes.forEach((route) =&gt; &#123;</span><br><span class="line">        router.addRoute(route);</span><br><span class="line">    &#125;);</span><br><span class="line">    router.push(&#123; name: &quot;Login&quot; &#125;); //跳转到登录页面</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
<h5 id="第二种：后端返回路由表"><a href="#第二种：后端返回路由表" class="headerlink" title="第二种：后端返回路由表"></a>第二种：后端返回路由表</h5><p>React：动态创建菜单</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建 ICON</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createIcon</span>(<span class="params">name</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">React</span>.<span class="title function_">createElement</span>(<span class="title class_">Icon</span>[name])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//   动态创建菜单</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">filterMenu</span>(<span class="params">data</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> cloneData = _.<span class="title function_">cloneDeep</span>(data)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> newData = cloneData.<span class="title function_">filter</span>(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!item.<span class="property">hidden</span>) &#123;</span><br><span class="line">      <span class="comment">// 判断是否需要在菜单中显示当前菜单项</span></span><br><span class="line">      item.<span class="property">icon</span> = <span class="title function_">createIcon</span>(item.<span class="property">icon</span>)</span><br><span class="line">      item.<span class="property">label</span> = <span class="language-xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&#123;item.path&#125;</span>&gt;</span>&#123;item.label&#125;<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (item.<span class="property">children</span> &amp;&amp; item.<span class="property">children</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        item.<span class="property">children</span> = <span class="title function_">filterMenu</span>(item.<span class="property">children</span>)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> newData</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">SideMenu</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="title class_">Sider</span> &#125; = <span class="title class_">Layout</span></span><br><span class="line">  <span class="keyword">const</span> authList = <span class="title function_">useSelector</span>(<span class="function">(<span class="params">state</span>) =&gt;</span> state.<span class="property">user</span>.<span class="property">authList</span>)</span><br><span class="line">  <span class="keyword">const</span> menuData = <span class="title function_">filterMenu</span>(authList)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Sider</span> <span class="attr">trigger</span>=<span class="string">&#123;null&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;logo&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Menu</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">theme</span>=<span class="string">&quot;dark&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">mode</span>=<span class="string">&quot;inline&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">defaultSelectedKeys</span>=<span class="string">&#123;[</span>&#x27;<span class="attr">1</span>&#x27;]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">defaultOpenKeys</span>=<span class="string">&#123;[</span>&#x27;<span class="attr">sub1</span>&#x27;]&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">items</span>=<span class="string">&#123;menuData&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Sider</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>动态创建路由：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 树状转扁平</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">treeToLevel1</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> result = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; data.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> obj = data[i]</span><br><span class="line">        <span class="keyword">var</span> cloneObj = _.<span class="title function_">cloneDeep</span>(obj)</span><br><span class="line">        <span class="keyword">delete</span> cloneObj.<span class="property">children</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (obj.<span class="property">component</span>) &#123;</span><br><span class="line">            result.<span class="title function_">push</span>(cloneObj)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (obj.<span class="property">children</span> &amp;&amp; obj.<span class="property">children</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> tem = <span class="title function_">treeToLevel1</span>(obj.<span class="property">children</span>)</span><br><span class="line">            result = result.<span class="title function_">concat</span>(tem)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义 hooks</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useRouteToDom</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> authList = <span class="title function_">useSelector</span>(<span class="function">(<span class="params">state</span>) =&gt;</span> state.<span class="property">user</span>.<span class="property">authList</span>)</span><br><span class="line">    <span class="keyword">const</span> domData = <span class="title function_">treeToLevel1</span>(authList)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;转树状：&#x27;</span>, domData)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//  &lt;Route path=&quot;authority/employee&quot; element=&#123;&lt;Employee /&gt;&#125; /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> arr = domData.<span class="title function_">map</span>(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="title class_">Com</span> = <span class="title class_">React</span>.<span class="title function_">lazy</span>(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">`../<span class="subst">$&#123;item.component&#125;</span>/index.jsx`</span>))</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;动态加载组件：&#x27;</span>, <span class="title class_">Com</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Route</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span> <span class="attr">path</span>=<span class="string">&#123;item.path&#125;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Com</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;处理后路由：&#x27;</span>, arr)</span><br><span class="line">        <span class="keyword">return</span> arr</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">                            <span class="keyword">const</span> <span class="title function_">AsyncRouter</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> authList = <span class="title function_">useSelector</span>(<span class="function">(<span class="params">state</span>) =&gt;</span> state.<span class="property">user</span>.<span class="property">authList</span>)</span><br><span class="line">        <span class="keyword">const</span> domData = <span class="title function_">treeToLevel1</span>(authList)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;转树状：&#x27;</span>, domData)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> arr = domData.<span class="title function_">map</span>(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> <span class="title class_">Com</span> = <span class="title class_">React</span>.<span class="title function_">lazy</span>(<span class="function">() =&gt;</span></span><br><span class="line">                                   <span class="keyword">import</span>(<span class="string">`../../Views/<span class="subst">$&#123;item.component&#125;</span>/index.jsx`</span>)</span><br><span class="line">                                  )</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Route</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span> <span class="attr">path</span>=<span class="string">&#123;item.path&#125;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Com</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line">                <span class="comment">// &lt;React.Suspense callback=&#123;&lt;div&gt;loading...&lt;/div&gt;&#125;&gt;</span></span><br><span class="line">                <span class="comment">// &lt;Com /&gt;</span></span><br><span class="line">                &#123;</span><br><span class="line">                <span class="comment">/* &lt;/React.Suspense&gt;&#125; /&gt;; */</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;处理后路由：&#x27;</span>, arr)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">React.Suspense</span> <span class="attr">callback</span>=<span class="string">&#123;</span>&lt;<span class="attr">div</span>&gt;</span>loading...<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Routes</span>&gt;</span>&#123;arr&#125;<span class="tag">&lt;/<span class="name">Routes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">React.Suspense</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">React</span>.<span class="title function_">memo</span>(<span class="title class_">AsyncRouter</span>)</span><br></pre></td></tr></table></figure>

<p>在Layout文件中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">Layout</span></span><br><span class="line">style=&#123;&#123;</span><br><span class="line">       <span class="attr">padding</span>: <span class="string">&#x27;0 24px 24px&#x27;</span>,</span><br><span class="line">      &#125;&#125;</span><br><span class="line">          &gt;</span><br><span class="line">              <span class="language-xml"><span class="tag">&lt;<span class="name">Bread</span> /&gt;</span></span></span><br><span class="line">              <span class="language-xml"><span class="tag">&lt;<span class="name">Content</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">className</span>=<span class="string">&quot;site-layout-background&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml"><span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">       <span class="attr">padding:</span> <span class="attr">24</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">       <span class="attr">margin:</span> <span class="attr">0</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">       <span class="attr">minHeight:</span> <span class="attr">280</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          &gt;</span></span></span><br><span class="line"><span class="language-xml">              &#123;/* <span class="tag">&lt;<span class="name">Outlet</span> /&gt;</span> */&#125;</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">AsyncRouter</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;/<span class="name">Content</span>&gt;</span></span></span><br><span class="line">&lt;/<span class="title class_">Layout</span>&gt;</span><br></pre></td></tr></table></figure>

<h4 id="1-3-内容权限，按钮权限控制"><a href="#1-3-内容权限，按钮权限控制" class="headerlink" title="1.3  内容权限，按钮权限控制"></a>1.3  内容权限，按钮权限控制</h4><p>概述： 不同的角色都能进入页面,但要求看到的页面内容不一样 </p>
<p> 按照<code>增删查改</code>四个维度对页面内容进行归类.使用简称<code>CURD</code>来标识(<code>CURD</code>分别代表创建（<code>Create</code>）、更新（<code>Update</code>）、读取（<code>Retrieve</code>）和删除（<code>Delete</code>）). </p>
<ul>
<li>后端返回用户列表</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">user_id</span>:<span class="number">1</span>,</span><br><span class="line">  <span class="attr">user_name</span>:<span class="string">&quot;张三&quot;</span>,</span><br><span class="line">  <span class="attr">permission_list</span>:&#123;</span><br><span class="line">    <span class="string">&quot;List&quot;</span>:<span class="string">&quot;CR&quot;</span>, <span class="comment">//权限编码</span></span><br><span class="line">    <span class="string">&quot;Detail&quot;</span>:<span class="string">&quot;CURD&quot;</span>  <span class="comment">//权限编码</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>设置全局自定义指令</li>
</ul>
<p> 当元素挂载完毕后,通过<code>binding.value</code>获取该元素要求的权限编码.然后拿到当前路由名称,通过路由名称可以在<code>vuex</code>中获取到该用户在该页面所拥有的权限编码.如果该用户不具备访问该元素的权限,就把元素<code>dom</code>移除. </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>); <span class="comment">//创建vue的根实例</span></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">directive</span>(<span class="string">&#x27;permission&#x27;</span>, &#123;</span><br><span class="line">    <span class="title function_">mounted</span>(<span class="params">el, binding, vnode</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> permission = binding.<span class="property">value</span>; <span class="comment">// 获取权限值</span></span><br><span class="line">        <span class="keyword">const</span> page_name = router.<span class="property">currentRoute</span>.<span class="property">value</span>.<span class="property">name</span>; <span class="comment">// 获取当前路由名称</span></span><br><span class="line">        <span class="keyword">const</span> have_permissions = store.<span class="property">state</span>.<span class="property">permission_list</span>[page_name] || <span class="string">&#x27;&#x27;</span>; <span class="comment">// 当前用户拥有的权限</span></span><br><span class="line">        <span class="keyword">if</span> (!have_permissions.<span class="title function_">includes</span>(permission)) &#123;</span><br><span class="line">            el.<span class="property">parentElement</span>.<span class="title function_">removeChild</span>(el); <span class="comment">//不拥有该权限移除dom元素</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>页面中使用</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-permission</span>=<span class="string">&quot;&#x27;U&#x27;&quot;</span>&gt;</span>修改<span class="tag">&lt;/<span class="name">button</span>&gt;</span>  <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-permission</span>=<span class="string">&quot;&#x27;D&#x27;&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-permission</span>=<span class="string">&quot;&#x27;C&#x27;&quot;</span>&gt;</span>发布需求<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">    &lt;!--列表页--&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-permission</span>=<span class="string">&quot;&#x27;R&#x27;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">     ...</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2-上传图片"><a href="#2-上传图片" class="headerlink" title="2. 上传图片"></a>2. 上传图片</h3><h4 id="1-前端"><a href="#1-前端" class="headerlink" title="1. 前端"></a>1. 前端</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">InboxOutlined</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@ant-design/icons&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; message, <span class="title class_">Upload</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">Dragger</span> &#125; = <span class="title class_">Upload</span></span><br><span class="line"><span class="keyword">const</span> props = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;file&#x27;</span>, <span class="comment">// 必须与后端一致</span></span><br><span class="line">  <span class="attr">multiple</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">  <span class="attr">listType</span>: <span class="string">&#x27;picture-card&#x27;</span>,</span><br><span class="line">  <span class="attr">action</span>: <span class="string">&#x27;http://localhost:3001/purchase/apply/uploadFile&#x27;</span>, <span class="comment">// 请求路径</span></span><br><span class="line">  <span class="title function_">onChange</span>(<span class="params">info</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; status &#125; = info.<span class="property">file</span></span><br><span class="line">    <span class="keyword">if</span> (status !== <span class="string">&#x27;uploading&#x27;</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(info.<span class="property">file</span>, info.<span class="property">fileList</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (status === <span class="string">&#x27;done&#x27;</span>) &#123;</span><br><span class="line">      message.<span class="title function_">success</span>(<span class="string">`<span class="subst">$&#123;info.file.name&#125;</span> 文件上传成功.`</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (status === <span class="string">&#x27;error&#x27;</span>) &#123;</span><br><span class="line">      message.<span class="title function_">error</span>(<span class="string">`<span class="subst">$&#123;info.file.name&#125;</span> 文件上传失败.`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">onDrop</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;取消文件上传&#x27;</span>, e.<span class="property">dataTransfer</span>.<span class="property">files</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">uploadFile</span> = (<span class="params"></span>) =&gt; (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Dragger</span> &#123;<span class="attr">...props</span>&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">className</span>=<span class="string">&quot;ant-upload-drag-icon&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">InboxOutlined</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">className</span>=<span class="string">&quot;ant-upload-text&quot;</span>&gt;</span>将文件拖拽到此处或点击上传<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">Dragger</span>&gt;</span></span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> uploadFile</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="2-后端"><a href="#2-后端" class="headerlink" title="2. 后端"></a>2. 后端</h4><h5 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> multer = <span class="built_in">require</span>(<span class="string">&#x27;multer&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">/* 文件上传函数 */</span></span><br><span class="line">  <span class="title function_">file_load</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 配置存储位置</span></span><br><span class="line">    <span class="keyword">const</span> fileDir = <span class="string">&#x27;./public/uploads&#x27;</span> <span class="comment">// 前提：必须保证该目录存在</span></span><br><span class="line">    <span class="keyword">const</span> storage = multer.<span class="title function_">diskStorage</span>(&#123;</span><br><span class="line">      <span class="attr">destination</span>: <span class="keyword">function</span> (<span class="params">req, file, cb</span>) &#123;</span><br><span class="line">        <span class="comment">// 存储地址</span></span><br><span class="line">        <span class="title function_">cb</span>(<span class="literal">null</span>, fileDir)</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">filename</span>: <span class="keyword">function</span> (<span class="params">req, file, cb</span>) &#123;</span><br><span class="line">        <span class="comment">// 配置文件名</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;上传文件：&#x27;</span>, file)</span><br><span class="line">        <span class="comment">// file.originalname 可以获取前端传递的图片名及其后缀，比如 10.small.jpg</span></span><br><span class="line">        <span class="keyword">const</span> filenameArr = file.<span class="property">originalname</span>.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>) <span class="comment">// [&#x27;10&#x27;, &#x27;small&#x27;, &#x27;jpg&#x27;]</span></span><br><span class="line">        <span class="keyword">const</span> ext = filenameArr[filenameArr.<span class="property">length</span> - <span class="number">1</span>] <span class="comment">// 数组最后一位，数组长度长度-1，后缀名 - &#x27;jpg&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> uniqueSuffix = <span class="title class_">Date</span>.<span class="title function_">now</span>() + <span class="string">&#x27;-&#x27;</span> + <span class="title class_">Math</span>.<span class="title function_">round</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">1e9</span>) <span class="comment">// 随机名字</span></span><br><span class="line">        <span class="comment">// file.fieldname 上传图片时约定的字段名</span></span><br><span class="line">        <span class="title function_">cb</span>(<span class="literal">null</span>, file.<span class="property">fieldname</span> + <span class="string">&#x27;-&#x27;</span> + uniqueSuffix + <span class="string">&#x27;.&#x27;</span> + ext) <span class="comment">// 必须上传后对图片重新命名</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">const</span> upload = <span class="title function_">multer</span>(&#123; <span class="attr">storage</span>: storage &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> upload</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="路由文件"><a href="#路由文件" class="headerlink" title="路由文件"></a>路由文件</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入配置文件</span></span><br><span class="line"><span class="keyword">const</span> file_load = <span class="built_in">require</span>(<span class="string">&#x27;../../utils/uploadFile&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上传文件</span></span><br><span class="line"><span class="keyword">const</span> upload = file_load.<span class="title function_">file_load</span>()</span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/uploadFile&#x27;</span>, upload.<span class="title function_">single</span>(<span class="string">&#x27;file&#x27;</span>), <span class="comment">// 该字段必须与前段一致</span></span><br><span class="line">applyController.<span class="property">uploadFile</span>)</span><br></pre></td></tr></table></figure>



<h3 id="3-封装的公共组件"><a href="#3-封装的公共组件" class="headerlink" title="3. 封装的公共组件"></a>3. 封装的公共组件</h3><h4 id="3-1-Vue"><a href="#3-1-Vue" class="headerlink" title="3.1 Vue"></a>3.1 Vue</h4><h5 id="3-1-1-二次封装"><a href="#3-1-1-二次封装" class="headerlink" title="3.1.1 二次封装"></a>3.1.1 二次封装</h5><h6 id="1-el-image-二次封装"><a href="#1-el-image-二次封装" class="headerlink" title="1. el-image 二次封装"></a>1. el-image 二次封装</h6><p>概述： image组件， 我们需要统一在图片加载失败的时候展示的特定图 </p>
<p>技术点：</p>
<ul>
<li><p>v-bind&#x3D;”$attrs”的妙用是在创建更高级别的组件，在封装第三方组件时，可以自动将在父作用域中使用的v-bind的属性自动绑定，并向下传入被封装的使用了v-bind&#x3D;”$attrs”的组件。</p>
</li>
<li><p>v-on&#x3D;”listeners”的作用 它可以将父作用域中的使用v-on的时间监听器向下传入到使用了v-on&#x3D;”listeners”组件中， 和v-bind&#x3D;”<em>l<strong>i</strong>s<strong>t</strong>e<strong>n</strong>e<strong>r</strong>s</em>“组件中，和<em>v</em>−<em>b<strong>i</strong>n**d</em>&#x3D;”attrs”的功效类似，只不过一个属性一个是事件。</p>
</li>
</ul>
<p>使用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;custom-<span class="title class_">Image</span> fit=<span class="string">&quot;fill&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;icon-img&quot;</span> :src=<span class="string">&quot;picPreview(expert)&quot;</span>&gt;&lt;/custom-<span class="title class_">Image</span>&gt;</span><br></pre></td></tr></table></figure>

<p>事例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;CustomImage&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">el-image</span> <span class="attr">v-bind</span>=<span class="string">&quot;$attrs&quot;</span> <span class="attr">v-on</span>=<span class="string">&quot;$listeners&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">slot</span>=<span class="string">&quot;error&quot;</span> <span class="attr">class</span>=<span class="string">&quot;image-slot&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">&quot;require(&#x27;image-f/icon-empty-img.png&#x27;)&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;图片加载失败.png&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">slot</span>=<span class="string">&quot;placeholder&quot;</span> <span class="attr">class</span>=<span class="string">&quot;placeholder-slot&quot;</span>&gt;</span>加载中...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">el-image</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">name</span>: <span class="string">&#x27;CustomImage&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">&quot;scss&quot;</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="selector-id">#CustomImage</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="selector-class">.image-slot</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="attribute">text-align</span>: center;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="selector-class">.placeholder-slot</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="attribute">text-align</span>: center;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="3-1-2-初始造轮子"><a href="#3-1-2-初始造轮子" class="headerlink" title="3.1.2 初始造轮子"></a>3.1.2 初始造轮子</h5><h6 id="1-模态框"><a href="#1-模态框" class="headerlink" title="1. 模态框"></a>1. 模态框</h6><ul>
<li>创建一个Vue文件，实现基本的结构和样式</li>
<li>标题通过Props传入，设置为必传。按钮默认一个确认按钮，可定制。可显示取消按钮，可定制。主体通过<code>slot</code>插槽处理。</li>
<li>弹窗组件开关由外部控制，但并不用show来控制， 而是对show进行监听，赋值给组件内部变量showSelf。 方便组件内部控制弹窗的隐藏。</li>
<li>保证弹窗的层级足够高，且弹窗内容的层级要比遮罩层的高，后弹窗的层级高于之前的层级。</li>
<li>点击遮罩层关闭弹窗和处理弹窗地步页面的的内容不可滚动。.self只在当前元素触发，不从内部触发。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;showSelf&quot;</span> <span class="attr">class</span>=<span class="string">&quot;dialog&quot;</span> <span class="attr">:style</span>=<span class="string">&quot;&#123;&#x27;z-index&#x27;: zIndex&#125;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dialog-mark&quot;</span> @<span class="attr">click.self</span>=<span class="string">&quot;closeMyself&quot;</span> <span class="attr">:style</span>=<span class="string">&quot;&#123;&#x27;z-index&#x27;: zIndex + 1&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">transition</span> <span class="attr">name</span>=<span class="string">&quot;dialog&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dialog-sprite&quot;</span> <span class="attr">:style</span>=<span class="string">&quot;&#123;&#x27;z-index&#x27;: zIndex + 2&#125;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="comment">&lt;!-- 标题 --&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">section</span> <span class="attr">v-if</span>=<span class="string">&quot;title&quot;</span> <span class="attr">class</span>=<span class="string">&quot;header&quot;</span>&gt;</span>&#123;&#123; title &#125;&#125;<span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    </span></span><br><span class="line"><span class="language-xml">                <span class="comment">&lt;!-- 弹窗的主题内容 --&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;dialog-body&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    </span></span><br><span class="line"><span class="language-xml">                <span class="comment">&lt;!-- 按钮 --&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;dialog-footer&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;showCancel&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-refuse&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;cancel&quot;</span>&gt;</span>&#123;&#123;cancelText&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-confirm&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;confirm&quot;</span>&gt;</span>&#123;&#123;confirmText&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">transition</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">props</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="comment">//弹窗组件是否显示 默认不显示 必传属性</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">show</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">type</span>: <span class="title class_">Boolean</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">default</span>: <span class="literal">false</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">required</span>: <span class="literal">true</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">title</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">type</span>: <span class="title class_">String</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">required</span>: <span class="literal">true</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">showCancel</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">typs</span>: <span class="title class_">Boolean</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">default</span>: <span class="literal">false</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">required</span>: <span class="literal">false</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">cancelText</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">type</span>: <span class="title class_">String</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">default</span>: <span class="string">&#x27;取消&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">required</span>: <span class="literal">false</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">confirmText</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">type</span>: <span class="title class_">String</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">default</span>: <span class="string">&#x27;确定&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">required</span>: <span class="literal">false</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">name</span>: <span class="string">&#x27;dialog&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">showSelf</span>: <span class="literal">false</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">zIndex</span>: <span class="variable language_">this</span>.<span class="title function_">getZIndex</span>(),</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">bodyOverflow</span>: <span class="string">&#x27;&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">watch</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="title function_">show</span>(<span class="params">val</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="keyword">if</span> (!val) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                    <span class="variable language_">this</span>.<span class="title function_">closeMyself</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                &#125; <span class="keyword">else</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                    <span class="variable language_">this</span>.<span class="property">showSelf</span> = val</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="title function_">created</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="variable language_">this</span>.<span class="property">showSelf</span> = <span class="variable language_">this</span>.<span class="property">show</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="variable language_">this</span>.<span class="title function_">forbidScroll</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="comment">/** 禁止页面滚动 */</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="title function_">forbidScroll</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="variable language_">this</span>.<span class="property">bodyOverflow</span> = <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">style</span>.<span class="property">overflow</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">style</span>.<span class="property">overflow</span> = <span class="string">&#x27;hidden&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="comment">/**  每次获取之后 zindex 自动增加 */</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="title function_">getZIndex</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="keyword">let</span> zIndexInit = <span class="number">20190315</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="keyword">return</span> zIndexInit++</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="comment">/** 取消按钮操作 */</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="title function_">cancel</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="variable language_">this</span>.$emit(<span class="string">&#x27;cancel&#x27;</span>, <span class="literal">false</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="comment">/** 确认按钮操作 */</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="title function_">confirm</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="variable language_">this</span>.$emit(<span class="string">&#x27;confirm&#x27;</span>, <span class="literal">false</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="comment">/** 点击遮罩关闭弹窗 */</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="title function_">closeMyself</span>(<span class="params">event</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="variable language_">this</span>.<span class="property">showSelf</span> = <span class="literal">false</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="variable language_">this</span>.<span class="title function_">sloveBodyOverflow</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="comment">/** 恢复页面的滚动 */</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="title function_">sloveBodyOverflow</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">style</span>.<span class="property">overflow</span> = <span class="variable language_">this</span>.<span class="property">bodyOverflow</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;less&quot;</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    // 弹窗动画</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="selector-class">.dialog-enter-active</span>,</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="selector-class">.dialog-leave-active</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">transition</span>: opacity .<span class="number">5s</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="selector-class">.dialog-enter</span>,</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="selector-class">.dialog-leave-to</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">opacity</span>: <span class="number">0</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    // 最外层 设置<span class="attribute">position</span>定位 </span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    // 遮罩 设置背景层，<span class="attribute">z-index</span>值要足够大确保能覆盖，高度 宽度设置满 做到全屏遮罩</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="selector-class">.dialog</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">position</span>: fixed;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">top</span>: <span class="number">0</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">right</span>: <span class="number">0</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">width</span>: <span class="number">100%</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">height</span>: <span class="number">100%</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        // 内容层 <span class="attribute">z-index</span>要比遮罩大，否则会被遮盖</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="selector-class">.dialog-mark</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">            <span class="attribute">position</span>: absolute;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">            <span class="attribute">top</span>: <span class="number">0</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">            <span class="attribute">height</span>: <span class="number">0</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">            <span class="attribute">width</span>: <span class="number">100%</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">            <span class="attribute">height</span>: <span class="number">100%</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">            <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, .<span class="number">6</span>);</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    </span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="selector-class">.dialog-sprite</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        // 移动端使用felx布局</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">position</span>: absolute;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">top</span>: <span class="number">10%</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">left</span>: <span class="number">15%</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">right</span>: <span class="number">15%</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">bottom</span>: <span class="number">25%</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">display</span>: flex;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">flex-direction</span>: column;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">max-height</span>: <span class="number">75%</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">min-height</span>: <span class="number">180px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">overflow</span>: hidden;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">z-index</span>: <span class="number">23456765435</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">background</span>: <span class="number">#fff</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">border-radius</span>: <span class="number">8px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="selector-class">.header</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">            <span class="attribute">padding</span>: <span class="number">15px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">            <span class="attribute">text-align</span>: center;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">            <span class="attribute">font-size</span>: <span class="number">18px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">            <span class="attribute">font-weight</span>: <span class="number">700</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">            <span class="attribute">color</span>: <span class="number">#333</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="selector-class">.dialog-body</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">            <span class="attribute">flex</span>: <span class="number">1</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">            <span class="attribute">overflow-x</span>: hidden;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">            <span class="attribute">overflow-y</span>: scroll;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">            <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">15px</span> <span class="number">20px</span> <span class="number">15px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="selector-class">.dialog-footer</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">            <span class="attribute">position</span>: relative;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">            <span class="attribute">display</span>: flex;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">            <span class="attribute">width</span>: <span class="number">100%</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">            // <span class="attribute">flex-shrink</span>: <span class="number">1</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">            &amp;<span class="selector-pseudo">::after</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">                <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">                <span class="attribute">position</span>: absolute;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">                <span class="attribute">top</span>: <span class="number">0</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">                <span class="attribute">left</span>: <span class="number">0</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">                <span class="attribute">width</span>: <span class="number">100%</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">                <span class="attribute">height</span>: <span class="number">1px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">                <span class="attribute">background</span>: <span class="number">#ddd</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">                <span class="attribute">transform</span>: <span class="built_in">scaleY</span>(.<span class="number">5</span>);</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">            &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">            <span class="selector-class">.btn</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">                <span class="attribute">flex</span>: <span class="number">1</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">                <span class="attribute">text-align</span>: center;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">                <span class="attribute">padding</span>: <span class="number">15px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">                <span class="attribute">font-size</span>: <span class="number">17px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">                &amp;<span class="selector-pseudo">:nth-child</span>(<span class="number">2</span>) &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">                    <span class="attribute">position</span>: relative;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">                    &amp;<span class="selector-pseudo">::after</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">                        <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">                        <span class="attribute">position</span>: absolute;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">                        <span class="attribute">left</span>: <span class="number">0</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">                        <span class="attribute">top</span>: <span class="number">0</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">                        <span class="attribute">width</span>: <span class="number">1px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">                        <span class="attribute">height</span>: <span class="number">100%</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">                        <span class="attribute">background</span>: <span class="number">#ddd</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">                        <span class="attribute">transform</span>: <span class="built_in">scaleX</span>(.<span class="number">5</span>);</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">                    &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">                &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">            &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">            <span class="selector-class">.btn-confirm</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">                <span class="attribute">color</span>: <span class="number">#43ac43</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">            &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>使用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;the-dialog :show=<span class="string">&quot;showDialog&quot;</span> @confirm=<span class="string">&quot;confirm2&quot;</span> @cancel=<span class="string">&quot;cancel&quot;</span> :showCancel=<span class="string">&quot;true&quot;</span> :title=<span class="string">&quot;&#x27;新标题&#x27;&quot;</span> :confirmText=<span class="string">&quot;`知道了`&quot;</span> :cancelText=<span class="string">&quot;`关闭`&quot;</span>&gt;</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>主题内容<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>主题内容<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">&lt;/the-dialog&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="comment">// 控制两个弹窗组件的初始显示与隐藏</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">showDialog</span>: <span class="literal">true</span>, </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="attr">showDialog2</span>: <span class="literal">true</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="title function_">cancel</span>(<span class="params">show</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="variable language_">this</span>.<span class="property">showDialog</span> = show</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="title function_">confirm</span>(<span class="params">show</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="variable language_">this</span>.<span class="property">showDialog</span> = show</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="title function_">cancel2</span>(<span class="params">show</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="variable language_">this</span>.<span class="property">showDialog2</span> = show</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="title function_">confirm2</span>(<span class="params">show</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="variable language_">this</span>.<span class="property">showDialog2</span> = show;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>



<h4 id="3-2-React"><a href="#3-2-React" class="headerlink" title="3.2 React"></a>3.2 React</h4><h5 id="1-全局dialog"><a href="#1-全局dialog" class="headerlink" title="1. 全局dialog"></a>1. 全局dialog</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; is, fromJS &#125; <span class="keyword">from</span> <span class="string">&#x27;immutable&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactCSSTransitionGroup</span> <span class="keyword">from</span> <span class="string">&#x27;react-addons-css-transition-group&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./dialog.css&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> defaultState = &#123;</span><br><span class="line">  <span class="attr">alertStatus</span>:<span class="literal">false</span>,</span><br><span class="line">  <span class="attr">alertTip</span>:<span class="string">&quot;提示&quot;</span>,</span><br><span class="line">  <span class="attr">closeDialog</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;&#125;,</span><br><span class="line">  <span class="attr">childs</span>:<span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dialog</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    ...defaultState</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// css动画组件设置为目标组件</span></span><br><span class="line">  <span class="title class_">FirstChild</span> = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> childrenArray = <span class="title class_">React</span>.<span class="property">Children</span>.<span class="title function_">toArray</span>(props.<span class="property">children</span>);</span><br><span class="line">    <span class="keyword">return</span> childrenArray[<span class="number">0</span>] || <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//打开弹窗</span></span><br><span class="line">  open =<span class="function">(<span class="params">options</span>)=&gt;</span>&#123;</span><br><span class="line">    options = options || &#123;&#125;;</span><br><span class="line">    options.<span class="property">alertStatus</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">var</span> props = options.<span class="property">props</span> || &#123;&#125;;</span><br><span class="line">    <span class="keyword">var</span> childs = <span class="variable language_">this</span>.<span class="title function_">renderChildren</span>(props,options.<span class="property">childrens</span>) || <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(childs);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      ...defaultState,</span><br><span class="line">      ...options,</span><br><span class="line">      childs</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//关闭弹窗</span></span><br><span class="line">  <span class="title function_">close</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span>.<span class="title function_">closeDialog</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      ...defaultState</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">renderChildren</span>(<span class="params">props,childrens</span>) &#123;</span><br><span class="line">    <span class="comment">//遍历所有子组件</span></span><br><span class="line">    <span class="keyword">var</span> childs = [];</span><br><span class="line">    childrens = childrens || [];</span><br><span class="line">    <span class="keyword">var</span> ps = &#123;</span><br><span class="line">        ...props,  <span class="comment">//给子组件绑定props</span></span><br><span class="line">        <span class="attr">_close</span>:<span class="variable language_">this</span>.<span class="property">close</span>  <span class="comment">//给子组件也绑定一个关闭弹窗的事件    </span></span><br><span class="line">       &#125;;</span><br><span class="line">    childrens.<span class="title function_">forEach</span>(<span class="function">(<span class="params">currentItem,index</span>) =&gt;</span> &#123;</span><br><span class="line">        childs.<span class="title function_">push</span>(<span class="title class_">React</span>.<span class="title function_">createElement</span>(</span><br><span class="line">            currentItem,</span><br><span class="line">            &#123;</span><br><span class="line">                ...ps,</span><br><span class="line">                <span class="attr">key</span>:index</span><br><span class="line">            &#125;</span><br><span class="line">        ));</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> childs;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">shouldComponentUpdate</span>(<span class="params">nextProps, nextState</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> !<span class="title function_">is</span>(<span class="title function_">fromJS</span>(<span class="variable language_">this</span>.<span class="property">props</span>), <span class="title function_">fromJS</span>(nextProps)) || !<span class="title function_">is</span>(<span class="title function_">fromJS</span>(<span class="variable language_">this</span>.<span class="property">state</span>), <span class="title function_">fromJS</span>(nextState))</span><br><span class="line">  &#125;</span><br><span class="line">   </span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">ReactCSSTransitionGroup</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">component</span>=<span class="string">&#123;this.FirstChild&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">transitionName</span>=<span class="string">&#x27;hide&#x27;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">transitionEnterTimeout</span>=<span class="string">&#123;300&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">transitionLeaveTimeout</span>=<span class="string">&#123;300&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;dialog-con&quot;</span> <span class="attr">style</span>=<span class="string">&#123;this.state.alertStatus?</span> &#123;<span class="attr">display:</span>&#x27;<span class="attr">block</span>&#x27;&#125;<span class="attr">:</span>&#123;<span class="attr">display:</span>&#x27;<span class="attr">none</span>&#x27;&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;this.state.childs&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ReactCSSTransitionGroup</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> div = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> props = &#123;</span><br><span class="line">   </span><br><span class="line">&#125;;</span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(div);</span><br><span class="line"><span class="keyword">let</span> <span class="title class_">Box</span> = <span class="title class_">ReactD</span></span><br></pre></td></tr></table></figure>



<h5 id="3-2-1-高阶组件"><a href="#3-2-1-高阶组件" class="headerlink" title="3.2.1 高阶组件"></a>3.2.1 高阶组件</h5><h3 id="4-封装的工具函数"><a href="#4-封装的工具函数" class="headerlink" title="4. 封装的工具函数"></a>4. 封装的工具函数</h3><h4 id="4-1-自定义hooks"><a href="#4-1-自定义hooks" class="headerlink" title="4.1 自定义hooks"></a>4.1 自定义hooks</h4><h5 id="1-useSessionStorage"><a href="#1-useSessionStorage" class="headerlink" title="1. useSessionStorage"></a>1. useSessionStorage</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useSessionStorage</span>(<span class="params">key</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [state, setState] = <span class="title function_">useState</span>(<span class="function">() =&gt;</span> <span class="title function_">getStorage</span>())</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">getStorage</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> value = <span class="variable language_">sessionStorage</span>.<span class="title function_">getItem</span>(key)</span><br><span class="line">    <span class="keyword">if</span> (value) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">JSON</span>.<span class="title function_">parse</span>(value)</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(error)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">undefined</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">updateState</span> = (<span class="params">newState</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 如果为undefined 则删除该键</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> newState == <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">      <span class="variable language_">sessionStorage</span>.<span class="title function_">removeItem</span>(key)</span><br><span class="line">      <span class="title function_">setState</span>(<span class="literal">undefined</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">sessionStorage</span>.<span class="title function_">setItem</span>(key, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(newState))</span><br><span class="line">      <span class="title function_">setState</span>(newState)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123; state, updateState &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="2-useList"><a href="#2-useList" class="headerlink" title="2. useList"></a>2. useList</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">listReq:api请求</span></span><br><span class="line"><span class="comment">option:obj</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    cur:当前页数</span></span><br><span class="line"><span class="comment">    size:一页多少条数据</span></span><br><span class="line"><span class="comment">    data:查询参数</span></span><br><span class="line"><span class="comment">    flag:是否自动请求</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useList</span>(<span class="params">listReq, option</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [list, setList] = <span class="title function_">useState</span>([])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> flag = option?.<span class="property">flag</span> || <span class="literal">true</span> <span class="comment">// 默认自动请求</span></span><br><span class="line">  <span class="keyword">const</span> cur = option?.<span class="property">cur</span> || <span class="number">1</span></span><br><span class="line">  <span class="keyword">const</span> size = option?.<span class="property">size</span> || <span class="number">5</span></span><br><span class="line">  <span class="keyword">const</span> data = option?.<span class="property">data</span> || &#123;&#125;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">getList</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> payload = &#123; ...data, <span class="attr">current</span>: cur, <span class="attr">pageSize</span>: size &#125;</span><br><span class="line">    <span class="title function_">listReq</span>(payload)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">code</span> == <span class="string">&#x27;200&#x27;</span>) &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">data</span>)</span><br><span class="line">          <span class="comment">//   setList(res.)</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;获取数据错误&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  flag &amp;&amp; <span class="title function_">getList</span>()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    list,</span><br><span class="line">    getList,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="4-2-自定义指令"><a href="#4-2-自定义指令" class="headerlink" title="4.2 自定义指令"></a>4.2 自定义指令</h4><h4 id="4-3-封装插件"><a href="#4-3-封装插件" class="headerlink" title="4.3 封装插件"></a>4.3 封装插件</h4><h5 id="1-全局try-catch"><a href="#1-全局try-catch" class="headerlink" title="1. 全局try catch"></a>1. 全局try catch</h5><p>思路：</p>
<ul>
<li>借助AST抽象语法树，遍历查找代码中的await关键字</li>
<li>找到await节点后，从父路径中查找声明的async函数，获取该函数的body（函数中包含的代码）</li>
<li>创建try&#x2F;catch语句，将原来async的body放入其中</li>
<li>最后将async的body替换成创建的try&#x2F;catch语句</li>
</ul>
<h3 id="5-封装的高阶组件"><a href="#5-封装的高阶组件" class="headerlink" title="5. 封装的高阶组件"></a>5. 封装的高阶组件</h3><h4 id="5-1-权限控制"><a href="#5-1-权限控制" class="headerlink" title="5.1 权限控制"></a>5.1 权限控制</h4><p>概述： 利用高阶组件的 条件渲染 特性可以对页面进行权限控制， </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">withAdminAuth</span>(<span class="params">WrappedComponent</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">class</span> <span class="title class_">extends</span> <span class="title class_">React</span>.<span class="property">Component</span> &#123;</span><br><span class="line">        state = &#123;</span><br><span class="line">            <span class="attr">isAdmin</span>: <span class="literal">false</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">async</span> <span class="title function_">UNSAFE_componentWillMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> currentRole = <span class="keyword">await</span> <span class="title function_">getCurrentUserRole</span>();</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">                <span class="attr">isAdmin</span>: currentRole === <span class="string">&#x27;Admin&#x27;</span>,</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">isAdmin</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">WrappedComponent</span> &#123;<span class="attr">...this.props</span>&#125; /&gt;</span></span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> (<span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>您没有权限查看该页面，请联系管理员！<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-2-页面复用"><a href="#5-2-页面复用" class="headerlink" title="5.2 页面复用"></a>5.2 页面复用</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">withFetching</span> = fetching =&gt; <span class="function"><span class="params">WrappedComponent</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">class</span> <span class="title class_">extends</span> <span class="title class_">React</span>.<span class="property">Component</span> &#123;</span><br><span class="line">        state = &#123;</span><br><span class="line">            <span class="attr">data</span>: [],</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">async</span> <span class="title function_">UNSAFE_componentWillMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">fetching</span>();</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">                data,</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">WrappedComponent</span> <span class="attr">data</span>=<span class="string">&#123;this.state.data&#125;</span> &#123;<span class="attr">...this.props</span>&#125; /&gt;</span></span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// pages/page-a.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">withFetching</span>(<span class="title function_">fetching</span>(<span class="string">&#x27;science-fiction&#x27;</span>))(<span class="title class_">MovieList</span>);</span><br></pre></td></tr></table></figure>

<h4 id="3-统一处理-loading"><a href="#3-统一处理-loading" class="headerlink" title="3. 统一处理 loading"></a>3. 统一处理 loading</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 公共逻辑处理 - 统一处理loading 高阶组件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">WidthTable</span> = (<span class="params">Component</span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;接受组件&#x27;</span>, <span class="title class_">Component</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">NewComponent</span> = (<span class="params">&#123; loading, ...otherProps &#125;</span>) =&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;HOC 的 props&#x27;</span>, otherProps)</span><br><span class="line">    <span class="keyword">if</span> (loading) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>loading...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Component</span>&gt;</span><span class="tag">&lt;/<span class="name">Component</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">NewComponent</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">WidthTable</span></span><br></pre></td></tr></table></figure>

<h4 id="4-路由鉴权"><a href="#4-路由鉴权" class="headerlink" title="4. 路由鉴权"></a>4. 路由鉴权</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Navigate</span>, useLocation &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useSelector &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">PrivateRoute</span> = (<span class="params">&#123; component: Component, ...rest &#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> location = <span class="title function_">useLocation</span>()</span><br><span class="line">  <span class="keyword">const</span> token = <span class="title function_">useSelector</span>(<span class="function">(<span class="params">state</span>) =&gt;</span> state.<span class="property">user</span>.<span class="property">token</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(token)</span><br><span class="line">  <span class="keyword">return</span> token ? (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Component</span> &#123;<span class="attr">...rest</span>&#125;&gt;</span><span class="tag">&lt;/<span class="name">Component</span>&gt;</span></span></span><br><span class="line">  ) : (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Navigate</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">to</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">pathname:</span> &#x27;/<span class="attr">login</span>&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">state:</span> &#123; <span class="attr">from:</span> <span class="attr">location</span> &#125;, // <span class="attr">重定向登录页</span>，<span class="attr">并且记录想要访问的页面</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &gt;</span><span class="tag">&lt;/<span class="name">Navigate</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">PrivateRoute</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="项目性能优化"><a href="#项目性能优化" class="headerlink" title="项目性能优化"></a>项目性能优化</h2><h2 id="一、-登陆"><a href="#一、-登陆" class="headerlink" title="一、 登陆"></a>一、 登陆</h2><p>概述：访问资源时所需要的凭证</p>
<h3 id="1-登陆处理流程"><a href="#1-登陆处理流程" class="headerlink" title="1. 登陆处理流程"></a>1. 登陆处理流程</h3><h4 id="1-1-token-处理"><a href="#1-1-token-处理" class="headerlink" title="1.1 token 处理"></a>1.1 token 处理</h4><p>前端通过发送账号和密码或账号和验证码给到后端后，后端验证通过会返回一个唯一的 <code>token</code> 作为该用户的登录凭证，前端将此凭证存储在vuex以及本地中，在之后的每个请求当中，请求头中都需带上这个 <code>token</code> 作为后端的登录校验。</p>
<p> <code>token</code> 有过期的机制，可以在请求拦截中做逻辑判断处理，若当前时间接近了过期时间，则通过更新 <code>token</code> 的接口请求更新 <code>token</code> ，在之后的请求中带上新的 <code>token</code> 。以此循环，若用户过长时间无操作，则可认为用户为离线状态，在用户之后的第一次请求时，由于 <code>token</code> 已经过期，访问后端接口会发生错误，根据后端返回的错误状态码作为判断，将系统定向至登录页面。<br>通过带有 <code>token</code> 请求头的请求方法，后端可以判断到是哪一个用户，前端也可以通过获取权限接口获得该用户的权限列表，根据权限列表做一份路由映射表，如果后端返回的数据结构与前端的路由设置的数据结构不同，此时还需编写此映射路由的业务功能函数。如果该用户拥有此路由权限，则通过在全局路由监控中 <code>router.beforeEach</code> 进行 <code>router</code> 中的 <code>addRoutes</code> 方法将有权限的路由配置添加到路由当中，侧边栏也可根据路由列表中的 <code>meta</code> 字段中关键字的判断进行相应的渲染。如果权限的颗粒度小到一个按钮，则可根据后端返回的权限列表映射出的权限参数，通过 <code>v-if</code> 进行判断该功能组件是否渲染。<br>在路由管理中通过 <code>router.beforeEach</code> 钩子中判断当前的路由权限是否为空，是的话则可执行获取权限路由的接口：</p>
<h4 id="1-2-手机验证码登陆"><a href="#1-2-手机验证码登陆" class="headerlink" title="1.2 手机验证码登陆"></a>1.2 手机验证码登陆</h4><ul>
<li>前端点击发送验证码，把手机号传给后端，后端深沉随机数，然后把号码以及短信内容(包括随机数)一起发送给第三方平台</li>
<li>短信发送成功的会调里把手机号和随机数存到数据库，</li>
<li>用户收到短信点登陆后，前端手机手机号和验证码传给后端和数据库进行对比验证成果就返回登陆成功和用户信息</li>
</ul>
<h3 id="2-token生成-服务器生成-："><a href="#2-token生成-服务器生成-：" class="headerlink" title="2. token生成(服务器生成)："></a>2. token生成(服务器生成)：</h3><p>利用 <code>jsonwebtoken</code> 模块， 该模块提供 <code>sign </code>生成 <code>token </code>，<code>verify </code>验证 <code>token</code>（一般使用 <code>express-jwt</code> 替代）<br>服务器端 - 安装:</p>
<p><code>npm i jsonwebtoken </code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> token = jwt.<span class="title function_">sign</span>(载荷, 密钥, options)</span><br><span class="line">      <span class="comment">// 载荷为一个对象，可以写任何非敏感信息</span></span><br><span class="line">      <span class="comment">// 密钥：是一个包含 HMAC 算法的密钥或者 密钥对，在验证 token 的时候也需要用到</span></span><br><span class="line">      <span class="comment">// options</span></span><br><span class="line">        algorithm：加密算法，默认 <span class="title class_">HS256</span></span><br><span class="line">        expiresIn：过期时间</span><br></pre></td></tr></table></figure>

<h3 id="3-token-验证"><a href="#3-token-验证" class="headerlink" title="3. token 验证"></a>3. token 验证</h3><p>利用<code>express-jwt</code> 模块：</p>
<p><code>npm i express-jwt</code></p>
<h3 id="4-token-的使用"><a href="#4-token-的使用" class="headerlink" title="4. token 的使用"></a>4. token 的使用</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用 </span></span><br><span class="line">   <span class="keyword">const</span> &#123; <span class="attr">expressjwt</span>: expressJwt &#125; = <span class="built_in">require</span>(<span class="string">&#x27;express-jwt&#x27;</span>);</span><br><span class="line"></span><br><span class="line">   <span class="comment">//拦截路由、验证 token 是否合法</span></span><br><span class="line">   app.<span class="title function_">use</span>(<span class="title function_">expressJwt</span>(&#123;</span><br><span class="line">     secret, <span class="comment">// 与 生成 token 的 密钥 相同</span></span><br><span class="line">     <span class="attr">algorithms</span>: [<span class="string">&#x27;HS256&#x27;</span>], <span class="comment">// 与生成 token 的加密算法一致</span></span><br><span class="line">   &#125;).<span class="title function_">unless</span>(&#123; <span class="comment">// 路由白名单，以下路由不受验证，可以直接写路径，也可以是正则匹配</span></span><br><span class="line">     <span class="attr">path</span>: [<span class="string">&#x27;/users/login&#x27;</span>]</span><br><span class="line">   &#125;))</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 如果没有通过，需要做错误处理</span></span><br><span class="line">   app.<span class="title function_">use</span>(<span class="keyword">function</span>(<span class="params">err, req, res, next</span>) &#123;</span><br><span class="line">     <span class="keyword">if</span>(err.<span class="property">name</span> === <span class="string">&#x27;UnauthorizedError&#x27;</span>) &#123;</span><br><span class="line">       res.<span class="title function_">status</span>(<span class="number">401</span>).<span class="title function_">json</span>() <span class="comment">// 这里响应状态吗 401，表示无权限访问</span></span><br><span class="line">     &#125;</span><br><span class="line">   &#125;)</span><br></pre></td></tr></table></figure>

<h3 id="5-前端处理-token"><a href="#5-前端处理-token" class="headerlink" title="5. 前端处理 token"></a>5. 前端处理 token</h3><h4 id="5-1-保存-token"><a href="#5-1-保存-token" class="headerlink" title="5.1 保存 token"></a>5.1 保存 token</h4><p>登陆之后获取token并保存在本地</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">loginAction</span> (context, data) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">axios</span>(&#123;</span><br><span class="line">          <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">          <span class="attr">url</span>: <span class="string">&#x27;/users/login&#x27;</span>,</span><br><span class="line">          data</span><br><span class="line">        &#125;)</span><br><span class="line">          .<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;登陆请求成功&#x27;</span>,res);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (res.<span class="property">code</span> == <span class="number">200</span>) &#123;</span><br><span class="line">              context.<span class="title function_">commit</span>(<span class="string">&#x27;loginMutation&#x27;</span>, &#123;</span><br><span class="line">                <span class="attr">token</span>:res.<span class="property">token</span>,</span><br><span class="line">                <span class="attr">userName</span>:data.<span class="property">userName</span></span><br><span class="line">              &#125;)</span><br><span class="line"></span><br><span class="line">              <span class="comment">// 本地缓存</span></span><br><span class="line">              <span class="variable language_">sessionStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;userName&#x27;</span>,data.<span class="property">userName</span>)</span><br><span class="line">              <span class="variable language_">sessionStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;token&#x27;</span>,res.<span class="property">token</span>)</span><br><span class="line"></span><br><span class="line">              <span class="title function_">resolve</span>()</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">          .<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;请求错误&#x27;</span>,err);</span><br><span class="line">          <span class="title function_">reject</span>()</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<h4 id="5-2-请求携带"><a href="#5-2-请求携带" class="headerlink" title="5.2 请求携带"></a>5.2 请求携带</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">instance.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(<span class="keyword">function</span> (<span class="params">config</span>) &#123;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// 获取 token</span></span><br><span class="line">     <span class="keyword">const</span> token = store.<span class="property">state</span>.<span class="property">token</span>;</span><br><span class="line">     <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;获取 token：&#x27;</span>, token);</span><br><span class="line"></span><br><span class="line">     <span class="comment">// 将 token 放在请求头</span></span><br><span class="line">     <span class="keyword">if</span>(token) &#123;</span><br><span class="line">       <span class="comment">// 该请求头由前后端约定、但是后端使用 express-jwt，就已经约束 Authorization 字段，并且值以 &#x27;Bearer &#x27; 开头</span></span><br><span class="line">       config.<span class="property">headers</span>[<span class="string">&#x27;Authorization&#x27;</span>] = <span class="string">&#x27;Bearer &#x27;</span> + token;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">return</span> config;</span><br><span class="line">   &#125;, <span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line">     <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">   &#125;);</span><br></pre></td></tr></table></figure>

<h4 id="5-3-未登录处理"><a href="#5-3-未登录处理" class="headerlink" title="5.3 未登录处理"></a>5.3 未登录处理</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"> instance.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(<span class="keyword">function</span> (<span class="params">response</span>) &#123;</span><br><span class="line">      <span class="comment">// 响应成功-200，先在这里接收到服务器响应</span></span><br><span class="line">      <span class="comment">// 2xx 范围内的状态码都会触发该函数。</span></span><br><span class="line">      <span class="comment">// 对响应数据做点什么</span></span><br><span class="line">      </span><br><span class="line">      <span class="keyword">return</span> response.<span class="property">data</span>; <span class="comment">// 对后端返回的数据过滤，直将 data 返回给页面</span></span><br><span class="line">    &#125;, <span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line">      <span class="comment">// 超出 2xx 范围的状态码都会触发该函数。</span></span><br><span class="line">      <span class="comment">// 对响应错误做点什么</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span>(error.<span class="property">response</span>.<span class="property">status</span> === <span class="number">401</span>) &#123; <span class="comment">// 表示未登录或者登录过期</span></span><br><span class="line">        <span class="comment">// 第一步、移除 token</span></span><br><span class="line">        store.<span class="title function_">commit</span>(<span class="string">&#x27;removeToken&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 第二步、重定向登录页</span></span><br><span class="line">        router.<span class="title function_">push</span>(<span class="string">&#x27;/login&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// removeToken</span></span><br><span class="line"> <span class="title function_">removeToken</span> (state) &#123;</span><br><span class="line">      state.<span class="property">token</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">      state.<span class="property">userName</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>





<h2 id="二、-项目错误"><a href="#二、-项目错误" class="headerlink" title="二、 项目错误"></a>二、 项目错误</h2><h4 id="1-Axios统一错误处理"><a href="#1-Axios统一错误处理" class="headerlink" title="1. Axios统一错误处理"></a>1. Axios统一错误处理</h4><p>对网络请求的响应进行统一处理</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">apiClient.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (error.<span class="property">response</span>.<span class="property">status</span> == <span class="number">401</span>) &#123;</span><br><span class="line">      router.<span class="title function_">push</span>(&#123; <span class="attr">name</span>: <span class="string">&quot;Login&quot;</span> &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      message.<span class="title function_">error</span>(<span class="string">&quot;出错了&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="2-Vue统一错误处理"><a href="#2-Vue统一错误处理" class="headerlink" title="2. Vue统一错误处理"></a>2. Vue统一错误处理</h4><p>使用全局的errorHandler</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="property">config</span>.<span class="property">errorHandler</span> = <span class="keyword">function</span>(<span class="params">err</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;global&quot;</span>, err);</span><br><span class="line">  message.<span class="title function_">error</span>(<span class="string">&quot;出错了&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...此处省略其他配置</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  router,</span><br><span class="line">  store,</span><br><span class="line">  <span class="attr">render</span>: <span class="function"><span class="params">h</span> =&gt;</span> <span class="title function_">h</span>(<span class="title class_">App</span>)</span><br><span class="line">&#125;).$mount(<span class="string">&quot;#app&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="3-React-统一错误处理"><a href="#3-React-统一错误处理" class="headerlink" title="3. React 统一错误处理"></a>3. React 统一错误处理</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span>, lazy, <span class="title class_">Suspense</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ErrorBoundary</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123; <span class="attr">hasError</span>: <span class="literal">false</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">getDerivedStateFromError</span>(<span class="params">error</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;getDerivedStateFromError&#x27;</span>) <span class="comment">// 先打印出来</span></span><br><span class="line">    <span class="comment">// 更新 state 使下一次渲染能够显示降级后的 UI</span></span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">hasError</span>: <span class="literal">true</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">componentDidCatch</span>(<span class="params">error, errorInfo</span>) &#123;</span><br><span class="line">    <span class="comment">// 你同样可以将错误日志上报给服务器</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;componentDidCatch&#x27;</span>) <span class="comment">// 后打印出来</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      <span class="attr">hasError</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">hasError</span>) &#123;</span><br><span class="line">      <span class="comment">// 你可以自定义降级后的 UI 并渲染</span></span><br><span class="line">      <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Something went wrong.<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">children</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ErrorBoundary</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root.<span class="title function_">render</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">ErrorBoundary</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">BrowserRouter</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">App</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">BrowserRouter</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">ErrorBoundary</span>&gt;</span></span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="4-全局捕获错误处理"><a href="#4-全局捕获错误处理" class="headerlink" title="4. 全局捕获错误处理"></a>4. 全局捕获错误处理</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;unhandledrejection&#x27;</span>, <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">处理事件对象</span><br><span class="line">event.<span class="property">reason</span> <span class="comment">//获取到catch的err的原因(内容) 与控制台报错一致</span></span><br><span class="line">event.<span class="property">promise</span> <span class="comment">//获取到未处理的promise对象</span></span><br><span class="line">.....</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h2 id="三、-两万条数据如何处理"><a href="#三、-两万条数据如何处理" class="headerlink" title="三、 两万条数据如何处理"></a>三、 两万条数据如何处理</h2><p>使用虚拟滚动条，后端进行分页，当每次下滑到一定的像素的时候发送请求，获取到下一页的数据。</p>
<h2 id="四、-版本管理"><a href="#四、-版本管理" class="headerlink" title="四、 版本管理"></a>四、 版本管理</h2><p>jenkins自动push打包</p>
<h2 id="五、-流量大，接口多如何处理"><a href="#五、-流量大，接口多如何处理" class="headerlink" title="五、 流量大，接口多如何处理"></a>五、 流量大，接口多如何处理</h2><p>缓存，ssr，预渲染，通过脚本平台，白名单等等，在上一个页面中预渲染下一个页面的数据。</p>
<h2 id="六、excel-导入导出"><a href="#六、excel-导入导出" class="headerlink" title="六、excel 导入导出"></a>六、excel 导入导出</h2><p>引入<code>xsml</code>依赖，主函数对数据进行过滤，使用数组的reduce方法<code>(接受一个函数作为参数，函数接受四个参数，若没有设置初始值，则第一个参数为计算结束的返回值，若有初始值，则为初始值，第二个参数为当前元素，第三个参数为当前元素的索引，常用于累加和累乘)</code>生成工作簿对象，再将工作簿转化为<code>json</code>对象。</p>
<p>接着创建a标签，利用a标签的download属性进行下载文件<code>aLink.href = url</code></p>
<p>然后将工作簿对象转化为我们需要的。首先生成excel的配置项，然后将字符串转化为<code>ArrayBuffer</code></p>
<p>最后进行转码操作。</p>
<h5 id="配置文件-1"><a href="#配置文件-1" class="headerlink" title="配置文件"></a>配置文件</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="variable constant_">XLSX</span> <span class="keyword">from</span> <span class="string">&#x27;xlsx&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ?+++++++++++++++++++++++++++++++++++++++++++++++ 主函数形参注释</span></span><br><span class="line"><span class="comment">// *--------------------------- header</span></span><br><span class="line"><span class="comment">// 注释：excel表头</span></span><br><span class="line"><span class="comment">// 类型：object</span></span><br><span class="line"><span class="comment">// 结构：</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//   name: &#x27;姓名&#x27;,</span></span><br><span class="line"><span class="comment">//   age: &#x27;年龄&#x27;,</span></span><br><span class="line"><span class="comment">//   address: &#x27;地址&#x27;,</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// *--------------------------- data</span></span><br><span class="line"><span class="comment">// 注释：导出数据</span></span><br><span class="line"><span class="comment">// 类型：array</span></span><br><span class="line"><span class="comment">// *--------------------------- fileName</span></span><br><span class="line"><span class="comment">// 注释：自定义导出文件名</span></span><br><span class="line"><span class="comment">// 类型：string</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ?+++++++++++++++++++++++++++++++++++++++++++++++ 主函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">clickToExport</span>(<span class="params">header, data, fileName</span>) &#123;</span><br><span class="line">  <span class="comment">// 数据过滤</span></span><br><span class="line">  <span class="keyword">let</span> newData = []</span><br><span class="line">  <span class="comment">// 生成header数组</span></span><br><span class="line">  <span class="keyword">let</span> headerKeys = <span class="title class_">Object</span>.<span class="title function_">keys</span>(header)</span><br><span class="line">  data.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> newItem = &#123;&#125;</span><br><span class="line">    <span class="comment">// 将data中的每一项遍历，给newItem重新赋值</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; headerKeys.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      newItem[headerKeys[i]] = item[headerKeys[i]]</span><br><span class="line">    &#125;</span><br><span class="line">    newItem.<span class="property">id</span> = index + <span class="number">1</span></span><br><span class="line">    newData.<span class="title function_">push</span>(newItem)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 生成工作簿对象</span></span><br><span class="line">  <span class="keyword">const</span> json = newData.<span class="title function_">map</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 数组reduce方法，第一个参数为回调函数，第二个参数为初始值。回调函数接受两个参数，第一个为累积变量，第二个为每一项。</span></span><br><span class="line">      <span class="comment">// 生成excel头部对应值</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">keys</span>(item).<span class="title function_">reduce</span>(<span class="function">(<span class="params">newData, key</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> newKey = header[key] || key</span><br><span class="line">      newData[newKey] = item[key]</span><br><span class="line">      <span class="keyword">return</span> newData</span><br><span class="line">    &#125;, &#123;&#125;)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 将工作簿对象转化为json对象</span></span><br><span class="line">  <span class="keyword">const</span> sheet = <span class="variable constant_">XLSX</span>.<span class="property">utils</span>.<span class="title function_">json_to_sheet</span>(json)</span><br><span class="line"></span><br><span class="line">  <span class="title function_">openDownloadDialog</span>(<span class="title function_">sheet2blob</span>(sheet, <span class="literal">undefined</span>), <span class="string">`<span class="subst">$&#123;fileName&#125;</span>.xlsx`</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ?+++++++++++++++++++++++++++++++++++++++++++++++ 创建a标签 利用a标签的download属性进行下载文件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">openDownloadDialog</span> = (<span class="params">url, saveName</span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 创建blob地址</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> url == <span class="string">&#x27;object&#x27;</span> &amp;&amp; url <span class="keyword">instanceof</span> <span class="title class_">Blob</span>) &#123;</span><br><span class="line">    url = <span class="variable constant_">URL</span>.<span class="title function_">createObjectURL</span>(url)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> aLink = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">  aLink.<span class="property">href</span> = url</span><br><span class="line">  <span class="comment">// HTML5新增的属性</span></span><br><span class="line">  <span class="comment">// 指定保存文件名</span></span><br><span class="line">  <span class="comment">// 可以不要后缀</span></span><br><span class="line">  <span class="comment">// 注意，file:///模式下不会生效</span></span><br><span class="line">  aLink.<span class="property">download</span> = saveName || <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> event</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">MouseEvent</span>) event = <span class="keyword">new</span> <span class="title class_">MouseEvent</span>(<span class="string">&#x27;click&#x27;</span>)</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    event = <span class="variable language_">document</span>.<span class="title function_">createEvent</span>(<span class="string">&#x27;MouseEvents&#x27;</span>)</span><br><span class="line">    event.<span class="title function_">initMouseEvent</span>(</span><br><span class="line">      <span class="string">&#x27;click&#x27;</span>,</span><br><span class="line">      <span class="literal">true</span>,</span><br><span class="line">      <span class="literal">false</span>,</span><br><span class="line">      <span class="variable language_">window</span>,</span><br><span class="line">      <span class="number">0</span>,</span><br><span class="line">      <span class="number">0</span>,</span><br><span class="line">      <span class="number">0</span>,</span><br><span class="line">      <span class="number">0</span>,</span><br><span class="line">      <span class="number">0</span>,</span><br><span class="line">      <span class="literal">false</span>,</span><br><span class="line">      <span class="literal">false</span>,</span><br><span class="line">      <span class="literal">false</span>,</span><br><span class="line">      <span class="literal">false</span>,</span><br><span class="line">      <span class="number">0</span>,</span><br><span class="line">      <span class="literal">null</span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  aLink.<span class="title function_">dispatchEvent</span>(event)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ?+++++++++++++++++++++++++++++++++++++++++++++++ 将工作簿对象转化为我们需要的</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">sheet2blob</span> = (<span class="params">sheet, sheetName</span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 生成excel的配置项</span></span><br><span class="line">  sheetName = sheetName || <span class="string">&#x27;sheet1&#x27;</span></span><br><span class="line">  <span class="keyword">let</span> workbook = &#123;</span><br><span class="line">    <span class="title class_">SheetNames</span>: [sheetName],</span><br><span class="line">    <span class="title class_">Sheets</span>: &#123;&#125;,</span><br><span class="line">  &#125;</span><br><span class="line">  workbook.<span class="property">Sheets</span>[sheetName] = sheet</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 字符串转ArrayBuffer</span></span><br><span class="line">  <span class="keyword">let</span> workbookOut = <span class="variable constant_">XLSX</span>.<span class="title function_">write</span>(workbook, &#123;</span><br><span class="line">    <span class="comment">// 要生成的文件类型</span></span><br><span class="line">    <span class="attr">bookType</span>: <span class="string">&#x27;xlsx&#x27;</span>,</span><br><span class="line">    <span class="comment">// 是否生成Shared String Table</span></span><br><span class="line">    <span class="comment">// 官方解释是，如果开启生成速度会下降</span></span><br><span class="line">    <span class="comment">// 但在低版本IOS设备上有更好的兼容性</span></span><br><span class="line">    <span class="attr">bookSST</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;binary&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">let</span> blob = <span class="keyword">new</span> <span class="title class_">Blob</span>([<span class="title function_">s2ab</span>(workbookOut)], &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;application/octet-stream&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> blob</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ?+++++++++++++++++++++++++++++++++++++++++++++++ 转码操作</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">s2ab</span>(<span class="params">wbo</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> buf = <span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(wbo.<span class="property">length</span>)</span><br><span class="line">  <span class="keyword">let</span> view = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>(buf)</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i !== wbo.<span class="property">length</span>; ++i) view[i] = wbo.<span class="title function_">charCodeAt</span>(i) &amp; <span class="number">0xff</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> buf</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> clickToExport</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//   导出excel</span></span><br><span class="line"> <span class="keyword">const</span> <span class="title function_">exportExcel</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">   chooseData?.<span class="property">length</span> &gt; <span class="number">0</span></span><br><span class="line">     ? <span class="title class_">Modal</span>.<span class="title function_">confirm</span>(&#123;</span><br><span class="line">         <span class="attr">title</span>: <span class="string">&#x27;导出&#x27;</span>,</span><br><span class="line">         <span class="attr">icon</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">ExclamationCircleOutlined</span> /&gt;</span></span>,</span><br><span class="line">         <span class="attr">content</span>: <span class="string">&#x27;是否确认导出&#x27;</span>,</span><br><span class="line">         <span class="title function_">onOk</span>(<span class="params"></span>) &#123;</span><br><span class="line">           <span class="keyword">let</span> header = &#123;&#125;</span><br><span class="line">           columns.<span class="title function_">slice</span>(<span class="number">1</span>, -<span class="number">1</span>).<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">             <span class="keyword">let</span> keys = <span class="title class_">Object</span>.<span class="title function_">keys</span>(item)</span><br><span class="line">             header[item[keys[<span class="number">1</span>]]] = item[keys[<span class="number">0</span>]]</span><br><span class="line">           &#125;)</span><br><span class="line">           chooseData?.<span class="property">length</span> &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">             <span class="title function_">clickToExport</span>(header, chooseData, <span class="string">&#x27;采购申请表&#x27;</span>)</span><br><span class="line">           <span class="title function_">setChooseData</span>(<span class="function">() =&gt;</span> []) <span class="comment">// 异步无法清空 或者重新请求数据</span></span><br><span class="line">         &#125;,</span><br><span class="line">         <span class="title function_">onCancel</span>(<span class="params"></span>) &#123;&#125;,</span><br><span class="line">       &#125;)</span><br><span class="line">     : <span class="title class_">Modal</span>.<span class="title function_">confirm</span>(&#123;</span><br><span class="line">         <span class="attr">title</span>: <span class="string">&#x27;导出&#x27;</span>,</span><br><span class="line">         <span class="attr">icon</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">ExclamationCircleOutlined</span> /&gt;</span></span>,</span><br><span class="line">         <span class="attr">content</span>: <span class="string">&#x27;请选择导出列表&#x27;</span>,</span><br><span class="line">       &#125;)</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>



<h2 id="七、-定时器问题"><a href="#七、-定时器问题" class="headerlink" title="七、 定时器问题"></a>七、 定时器问题</h2><p>概述： 我在a页面写一个定时，让他每秒钟打印一个1，然后跳转到b页面，此时可以看到，定时器依然在执行。这样是非常消耗性能的。 </p>
<p>解决： 该方法是通过$once这个事件侦听器器在定义完定时器之后的位置来清除定时器 。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span>&#123;                    </span><br><span class="line">    <span class="comment">// 某些定时器操作                </span></span><br><span class="line">&#125;, <span class="number">500</span>);            </span><br><span class="line"><span class="comment">// 通过$once来监听定时器，在beforeDestroy钩子可以被清除。</span></span><br><span class="line"><span class="variable language_">this</span>.$once(<span class="string">&#x27;hook:beforeDestroy&#x27;</span>, <span class="function">() =&gt;</span> &#123;            </span><br><span class="line">    <span class="built_in">clearInterval</span>(timer);                                    </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="八、-gzip压缩"><a href="#八、-gzip压缩" class="headerlink" title="八、 gzip压缩"></a>八、 gzip压缩</h2><p> spa这种单页应用，首屏由于一次性加载所有资源，所有首屏加载速度很慢。解决这个问题非常有效的手段之一就是前后端开启gizp（其他还有缓存、路由懒加载等等） </p>
<p>下载插件：</p>
<p><code>npm i compression-webpack-plugin**@1**.1.11 </code></p>
<p>然后在config&#x2F;index.js中开启</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">build</span>: &#123;</span><br><span class="line">    <span class="comment">// 其他代码</span></span><br><span class="line">    …………</span><br><span class="line">    <span class="attr">productionGzip</span>: <span class="literal">true</span>, <span class="comment">// false不开启gizp，true开启</span></span><br><span class="line">    <span class="comment">// 其他代码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="九、实时通讯"><a href="#九、实时通讯" class="headerlink" title="九、实时通讯"></a>九、实时通讯</h2><h3 id="1-Websocket"><a href="#1-Websocket" class="headerlink" title="1. Websocket"></a>1. Websocket</h3><p>概述： WebSocket是HTML5提供的一种浏览器与服务器进行全双工通讯的网络技术，属于应用层协议。它基于TCP传输协议，并复用HTTP的握手通道。浏览器和服务器只需要完成一次握手，两者之间就直接可以创建持久性的连接， 并进行双向数据传输。 </p>
<p>作用： ：服务器可以向客户端主动推动消息，客户端也可以主动向服务器推送消息。 </p>
<p>原理： 客户端向 WebSocket 服务器通知（notify）一个带有所有接收者ID（recipients IDs）的事件（event），服务器接收后立即通知所有活跃的（active）客户端，只有ID在接收者ID序列中的客户端才会处理这个事件。</p>
<p>使用：</p>
<p><code>npm i ws</code></p>
<p>服务端：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">WebSocketServer</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;ws&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">WebSocket</span> = <span class="built_in">require</span>(<span class="string">&#x27;ws&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> wss = <span class="keyword">new</span> <span class="title class_">WebSocketServer</span>(&#123;</span><br><span class="line">  <span class="attr">port</span>: <span class="number">8080</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">let</span> users = []</span><br><span class="line"></span><br><span class="line">wss.<span class="title function_">on</span>(<span class="string">&#x27;connection&#x27;</span>, <span class="function">(<span class="params">ws, req</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;客户端已连接：&#x27;</span>, req.<span class="property">socket</span>.<span class="property">remoteAddress</span>) <span class="comment">// 获取客户端 ip</span></span><br><span class="line"></span><br><span class="line">  ws.<span class="title function_">on</span>(<span class="string">&#x27;message&#x27;</span>, <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> data = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(res.<span class="title function_">toString</span>())</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;收到客户端发送的消息：&#x27;</span>, data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (data.<span class="property">type</span> == <span class="string">&#x27;online&#x27;</span>) &#123;</span><br><span class="line">      users.<span class="title function_">push</span>(data)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (data.<span class="property">type</span> == <span class="string">&#x27;offline&#x27;</span>) &#123;</span><br><span class="line">      users = users.<span class="title function_">filter</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">username</span> != data.<span class="property">username</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (data.<span class="property">type</span> == <span class="string">&#x27;msg&#x27;</span>) &#123;</span><br><span class="line">      <span class="comment">// console.log(&quot;已连接客户端&quot;, wss.clients);</span></span><br><span class="line">      wss.<span class="property">clients</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">client</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (client.<span class="property">readyState</span> === <span class="title class_">WebSocket</span>.<span class="property">OPEN</span>) &#123;</span><br><span class="line">          client.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data))</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="comment">// ws.send(data);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ws.send(&quot;我是服务端&quot;); // 向当前客户端发送消息</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  ws.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;连接出错：&#x27;</span>, err)</span><br><span class="line">  &#125;)</span><br><span class="line">  ws.<span class="title function_">on</span>(<span class="string">&#x27;close&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;客户端断开：&#x27;</span>, e)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p> 客户端：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> wsUrl = <span class="string">&#x27;ws://127.0.0.1:8080/?name=&#x27;</span> + username</span><br><span class="line"><span class="keyword">const</span> ws = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(wsUrl)</span><br><span class="line"></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 连接上</span></span><br><span class="line">    ws.<span class="property">onopen</span> = <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;客户端socket&#x27;开启&quot;</span>)</span><br><span class="line"></span><br><span class="line">        ws.<span class="title function_">send</span>(</span><br><span class="line">            <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;online&#x27;</span>,</span><br><span class="line">                username,</span><br><span class="line">            &#125;)</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 收到服务端消息</span></span><br><span class="line">    ws.<span class="property">onmessage</span> = <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> data = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(res.<span class="property">data</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;收到消息&#x27;</span>, data)</span><br><span class="line">        <span class="title function_">setChatList</span>(<span class="function">(<span class="params">pre</span>) =&gt;</span> [...pre, data])</span><br><span class="line">        <span class="comment">// ws.close();</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 断开连接</span></span><br><span class="line">    ws.<span class="property">onclose</span> = <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;关闭&#x27;</span>, e)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 连接出错</span></span><br><span class="line">    ws.<span class="property">onerror</span> = <span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;出错&#x27;</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        ws.<span class="title function_">send</span>(</span><br><span class="line">            <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;offline&#x27;</span>,</span><br><span class="line">                username,</span><br><span class="line">            &#125;)</span><br><span class="line">        )</span><br><span class="line">        ws.<span class="title function_">close</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, [])</span><br></pre></td></tr></table></figure>



<h3 id="2-短轮询"><a href="#2-短轮询" class="headerlink" title="2. 短轮询"></a>2. 短轮询</h3><p>概述： 浏览器每隔一段时间向浏览器发送 http 请求，服务器端在收到请求后，不论是否有数据更新，都直接进行响应。 </p>
<h3 id="3-长轮询"><a href="#3-长轮询" class="headerlink" title="3. 长轮询"></a>3. 长轮询</h3><p>概述： 首先由客户端向服务器发起请求，当服务器收到客户端发来的请求后，服务器端不会直接进行响应，而是先将这个请求挂起，然后判断服务器端数据是否有更新。如果有更新，则进行响应，如果一直没有数据，则到达一定的时间限制才返回。 </p>
<h2 id="十、浏览器的Devtool的使用"><a href="#十、浏览器的Devtool的使用" class="headerlink" title="十、浏览器的Devtool的使用"></a>十、浏览器的Devtool的使用</h2><h3 id="元素面板-Elements"><a href="#元素面板-Elements" class="headerlink" title="元素面板 Elements"></a>元素面板 Elements</h3><p>能在元素面板查看选择当前页的DOM树，能够实时的修改和调试。</p>
<p>可以再每行代码前面右键添加断点。属性改变，子节点改变，节点删除。</p>
<p>可以右键选择节点的状态：<code>active``:hovwe</code>等等</p>
<h3 id="网络面板-Network"><a href="#网络面板-Network" class="headerlink" title="网络面板 Network"></a>网络面板 Network</h3><p>与后端调试接口时，有时候会重新请求一次(Replay XHR)或者阻断请求(Block request URL)</p>
<p>查看请求参数和请求到的数据</p>
<h3 id="性能面板-Performance"><a href="#性能面板-Performance" class="headerlink" title="性能面板 Performance"></a>性能面板 Performance</h3><p>在这个面板你可以录制一段操作，然后查看录制期间的一些页面性能信息，录制前有几个选项可选，包括网络环境模拟，CPU速度模拟，是否开启录制期间截屏 </p>
<h3 id="控制台面板-Console"><a href="#控制台面板-Console" class="headerlink" title="控制台面板 Console"></a>控制台面板 Console</h3><p>打印输出调试bug，观察数据结构</p>
<h3 id="源代码面板-Sources"><a href="#源代码面板-Sources" class="headerlink" title="源代码面板 Sources"></a>源代码面板 Sources</h3><p>可以看到一些原文件和代码</p>
<p> 类似元素面板中设置<strong>断点（debugger）</strong>，这里也可以在每一行代码前设置断点，利用这些断点使代码运行到适当的时候或位置停下来，以便查看特定时刻的变量值、调用堆栈、样式等； </p>
<h3 id="内存面板-Memory"><a href="#内存面板-Memory" class="headerlink" title="内存面板 Memory"></a>内存面板 Memory</h3><p> 在此面板录制，可以使用CPU 分析器识别开销大的<strong>js函数</strong>。 </p>
<p> CPU 分析器准确地记录调用了哪些函数和每个函数花费的时间。也可以将配置文件可视化为火焰图。（执行js比较卡的时候可以用这个工具来查找原因）； </p>
<h3 id="应用面板-Application"><a href="#应用面板-Application" class="headerlink" title="应用面板 Application"></a>应用面板 Application</h3><p> 查看和修改Local Storage与Session Storage，并可查看cookies： </p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">野菜</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/2021/08/17/program/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/2021/08/17/program/')">项目总结</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/2021/08/17/program/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=项目总结&amp;url=http://example.com/2021/08/17/program/&amp;pic=//img.mp.itc.cn/upload/20160518/f260fbc2a76f45319924b1a884a37cf3_th.jpg" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">野菜</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>项目总结<span class="tagsPageCount">1</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="/img/bg.jpeg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/08/11/ajax/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic.baike.soso.com/ugc/baikepic2/20413/20180204171445-1480901917_jpeg_777_493_100869.jpg/0" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">AJAX和Axios笔记</div></div></a></div><div class="next-post pull-right"><a href="/2021/11/21/HTML/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="//gd-hbimg.huaban.com/2ccd6b1037890aedccea18f8ec13e755b7e64f2410d90b-27xWHz" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">HTML笔记</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description"></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">项目介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E9%A1%B9%E7%9B%AE%E6%B5%81%E7%A8%8B"><span class="toc-number">1.1.</span> <span class="toc-text">1. 项目流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%A1%B9%E7%9B%AE%E8%BF%AD%E4%BB%A3"><span class="toc-number">1.2.</span> <span class="toc-text">2. 项目迭代</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%81%94%E8%B0%83"><span class="toc-number">1.3.</span> <span class="toc-text">3. 联调</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E9%9A%BE%E7%82%B9%E5%92%8C%E4%BA%AE%E7%82%B9"><span class="toc-number">2.</span> <span class="toc-text">项目难点和亮点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86"><span class="toc-number">2.1.</span> <span class="toc-text">1.  权限管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E7%99%BB%E5%BD%95%E6%9D%83%E9%99%90"><span class="toc-number">2.1.1.</span> <span class="toc-text">1.1 登录权限</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E9%A1%B5%E9%9D%A2%E6%9D%83%E9%99%90"><span class="toc-number">2.1.2.</span> <span class="toc-text">1.2 页面权限</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%A7%8D%EF%BC%9A%E5%89%8D%E7%AB%AF%E5%A4%84%E7%90%86"><span class="toc-number">2.1.2.1.</span> <span class="toc-text">第一种：前端处理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%A7%8D%EF%BC%9A%E5%90%8E%E7%AB%AF%E8%BF%94%E5%9B%9E%E8%B7%AF%E7%94%B1%E8%A1%A8"><span class="toc-number">2.1.2.2.</span> <span class="toc-text">第二种：后端返回路由表</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E5%86%85%E5%AE%B9%E6%9D%83%E9%99%90%EF%BC%8C%E6%8C%89%E9%92%AE%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6"><span class="toc-number">2.1.3.</span> <span class="toc-text">1.3  内容权限，按钮权限控制</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87"><span class="toc-number">2.2.</span> <span class="toc-text">2. 上传图片</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%89%8D%E7%AB%AF"><span class="toc-number">2.2.1.</span> <span class="toc-text">1. 前端</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%90%8E%E7%AB%AF"><span class="toc-number">2.2.2.</span> <span class="toc-text">2. 后端</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">2.2.2.1.</span> <span class="toc-text">配置文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E6%96%87%E4%BB%B6"><span class="toc-number">2.2.2.2.</span> <span class="toc-text">路由文件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%B0%81%E8%A3%85%E7%9A%84%E5%85%AC%E5%85%B1%E7%BB%84%E4%BB%B6"><span class="toc-number">2.3.</span> <span class="toc-text">3. 封装的公共组件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-Vue"><span class="toc-number">2.3.1.</span> <span class="toc-text">3.1 Vue</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1-1-%E4%BA%8C%E6%AC%A1%E5%B0%81%E8%A3%85"><span class="toc-number">2.3.1.1.</span> <span class="toc-text">3.1.1 二次封装</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-el-image-%E4%BA%8C%E6%AC%A1%E5%B0%81%E8%A3%85"><span class="toc-number">2.3.1.1.1.</span> <span class="toc-text">1. el-image 二次封装</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1-2-%E5%88%9D%E5%A7%8B%E9%80%A0%E8%BD%AE%E5%AD%90"><span class="toc-number">2.3.1.2.</span> <span class="toc-text">3.1.2 初始造轮子</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-%E6%A8%A1%E6%80%81%E6%A1%86"><span class="toc-number">2.3.1.2.1.</span> <span class="toc-text">1. 模态框</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-React"><span class="toc-number">2.3.2.</span> <span class="toc-text">3.2 React</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%85%A8%E5%B1%80dialog"><span class="toc-number">2.3.2.1.</span> <span class="toc-text">1. 全局dialog</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-1-%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6"><span class="toc-number">2.3.2.2.</span> <span class="toc-text">3.2.1 高阶组件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%B0%81%E8%A3%85%E7%9A%84%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0"><span class="toc-number">2.4.</span> <span class="toc-text">4. 封装的工具函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-%E8%87%AA%E5%AE%9A%E4%B9%89hooks"><span class="toc-number">2.4.1.</span> <span class="toc-text">4.1 自定义hooks</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-useSessionStorage"><span class="toc-number">2.4.1.1.</span> <span class="toc-text">1. useSessionStorage</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-useList"><span class="toc-number">2.4.1.2.</span> <span class="toc-text">2. useList</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%87%E4%BB%A4"><span class="toc-number">2.4.2.</span> <span class="toc-text">4.2 自定义指令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-%E5%B0%81%E8%A3%85%E6%8F%92%E4%BB%B6"><span class="toc-number">2.4.3.</span> <span class="toc-text">4.3 封装插件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%85%A8%E5%B1%80try-catch"><span class="toc-number">2.4.3.1.</span> <span class="toc-text">1. 全局try catch</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%B0%81%E8%A3%85%E7%9A%84%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6"><span class="toc-number">2.5.</span> <span class="toc-text">5. 封装的高阶组件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6"><span class="toc-number">2.5.1.</span> <span class="toc-text">5.1 权限控制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-%E9%A1%B5%E9%9D%A2%E5%A4%8D%E7%94%A8"><span class="toc-number">2.5.2.</span> <span class="toc-text">5.2 页面复用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E7%BB%9F%E4%B8%80%E5%A4%84%E7%90%86-loading"><span class="toc-number">2.5.3.</span> <span class="toc-text">3. 统一处理 loading</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E8%B7%AF%E7%94%B1%E9%89%B4%E6%9D%83"><span class="toc-number">2.5.4.</span> <span class="toc-text">4. 路由鉴权</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="toc-number">3.</span> <span class="toc-text">项目性能优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81-%E7%99%BB%E9%99%86"><span class="toc-number">4.</span> <span class="toc-text">一、 登陆</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%99%BB%E9%99%86%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B"><span class="toc-number">4.1.</span> <span class="toc-text">1. 登陆处理流程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-token-%E5%A4%84%E7%90%86"><span class="toc-number">4.1.1.</span> <span class="toc-text">1.1 token 处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E6%89%8B%E6%9C%BA%E9%AA%8C%E8%AF%81%E7%A0%81%E7%99%BB%E9%99%86"><span class="toc-number">4.1.2.</span> <span class="toc-text">1.2 手机验证码登陆</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-token%E7%94%9F%E6%88%90-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%94%9F%E6%88%90-%EF%BC%9A"><span class="toc-number">4.2.</span> <span class="toc-text">2. token生成(服务器生成)：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-token-%E9%AA%8C%E8%AF%81"><span class="toc-number">4.3.</span> <span class="toc-text">3. token 验证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-token-%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">4.4.</span> <span class="toc-text">4. token 的使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%89%8D%E7%AB%AF%E5%A4%84%E7%90%86-token"><span class="toc-number">4.5.</span> <span class="toc-text">5. 前端处理 token</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-%E4%BF%9D%E5%AD%98-token"><span class="toc-number">4.5.1.</span> <span class="toc-text">5.1 保存 token</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-%E8%AF%B7%E6%B1%82%E6%90%BA%E5%B8%A6"><span class="toc-number">4.5.2.</span> <span class="toc-text">5.2 请求携带</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-%E6%9C%AA%E7%99%BB%E5%BD%95%E5%A4%84%E7%90%86"><span class="toc-number">4.5.3.</span> <span class="toc-text">5.3 未登录处理</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81-%E9%A1%B9%E7%9B%AE%E9%94%99%E8%AF%AF"><span class="toc-number">5.</span> <span class="toc-text">二、 项目错误</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-Axios%E7%BB%9F%E4%B8%80%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="toc-number">5.0.1.</span> <span class="toc-text">1. Axios统一错误处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-Vue%E7%BB%9F%E4%B8%80%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="toc-number">5.0.2.</span> <span class="toc-text">2. Vue统一错误处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-React-%E7%BB%9F%E4%B8%80%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="toc-number">5.0.3.</span> <span class="toc-text">3. React 统一错误处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%85%A8%E5%B1%80%E6%8D%95%E8%8E%B7%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="toc-number">5.0.4.</span> <span class="toc-text">4. 全局捕获错误处理</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81-%E4%B8%A4%E4%B8%87%E6%9D%A1%E6%95%B0%E6%8D%AE%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86"><span class="toc-number">6.</span> <span class="toc-text">三、 两万条数据如何处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81-%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86"><span class="toc-number">7.</span> <span class="toc-text">四、 版本管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81-%E6%B5%81%E9%87%8F%E5%A4%A7%EF%BC%8C%E6%8E%A5%E5%8F%A3%E5%A4%9A%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86"><span class="toc-number">8.</span> <span class="toc-text">五、 流量大，接口多如何处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81excel-%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA"><span class="toc-number">9.</span> <span class="toc-text">六、excel 导入导出</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-1"><span class="toc-number">9.0.0.1.</span> <span class="toc-text">配置文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">9.0.0.2.</span> <span class="toc-text">使用</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81-%E5%AE%9A%E6%97%B6%E5%99%A8%E9%97%AE%E9%A2%98"><span class="toc-number">10.</span> <span class="toc-text">七、 定时器问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81-gzip%E5%8E%8B%E7%BC%A9"><span class="toc-number">11.</span> <span class="toc-text">八、 gzip压缩</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B9%9D%E3%80%81%E5%AE%9E%E6%97%B6%E9%80%9A%E8%AE%AF"><span class="toc-number">12.</span> <span class="toc-text">九、实时通讯</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Websocket"><span class="toc-number">12.1.</span> <span class="toc-text">1. Websocket</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%9F%AD%E8%BD%AE%E8%AF%A2"><span class="toc-number">12.2.</span> <span class="toc-text">2. 短轮询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E9%95%BF%E8%BD%AE%E8%AF%A2"><span class="toc-number">12.3.</span> <span class="toc-text">3. 长轮询</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E3%80%81%E6%B5%8F%E8%A7%88%E5%99%A8%E7%9A%84Devtool%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">13.</span> <span class="toc-text">十、浏览器的Devtool的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%83%E7%B4%A0%E9%9D%A2%E6%9D%BF-Elements"><span class="toc-number">13.1.</span> <span class="toc-text">元素面板 Elements</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E9%9D%A2%E6%9D%BF-Network"><span class="toc-number">13.2.</span> <span class="toc-text">网络面板 Network</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E9%9D%A2%E6%9D%BF-Performance"><span class="toc-number">13.3.</span> <span class="toc-text">性能面板 Performance</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E5%8F%B0%E9%9D%A2%E6%9D%BF-Console"><span class="toc-number">13.4.</span> <span class="toc-text">控制台面板 Console</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BA%90%E4%BB%A3%E7%A0%81%E9%9D%A2%E6%9D%BF-Sources"><span class="toc-number">13.5.</span> <span class="toc-text">源代码面板 Sources</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E9%9D%A2%E6%9D%BF-Memory"><span class="toc-number">13.6.</span> <span class="toc-text">内存面板 Memory</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E9%9D%A2%E6%9D%BF-Application"><span class="toc-number">13.7.</span> <span class="toc-text">应用面板 Application</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/11/04/js%E7%B1%BB%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/" title="js的使用方法"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/bg.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="js的使用方法"/></a><div class="content"><a class="title" href="/2025/11/04/js%E7%B1%BB%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/" title="js的使用方法">js的使用方法</a><time datetime="2025-11-04T10:19:31.194Z" title="发表于 2025-11-04 18:19:31">2025-11-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/11/04/%E5%AD%A6%E4%B9%A0ts/" title="ts学习"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/bg.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ts学习"/></a><div class="content"><a class="title" href="/2025/11/04/%E5%AD%A6%E4%B9%A0ts/" title="ts学习">ts学习</a><time datetime="2025-11-04T10:02:22.066Z" title="发表于 2025-11-04 18:02:22">2025-11-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/11/02/jsproject/" title="js工具"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/bg.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="js工具"/></a><div class="content"><a class="title" href="/2025/11/02/jsproject/" title="js工具">js工具</a><time datetime="2025-11-01T16:00:00.000Z" title="发表于 2025-11-02 00:00:00">2025-11-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/10/29/mysql/" title="MySQL使用手册"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/bg.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL使用手册"/></a><div class="content"><a class="title" href="/2025/10/29/mysql/" title="MySQL使用手册">MySQL使用手册</a><time datetime="2025-10-28T16:00:00.000Z" title="发表于 2025-10-29 00:00:00">2025-10-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/10/26/Nginx/" title="Nginx配置"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/bg.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Nginx配置"/></a><div class="content"><a class="title" href="/2025/10/26/Nginx/" title="Nginx配置">Nginx配置</a><time datetime="2025-10-25T16:00:00.000Z" title="发表于 2025-10-26 00:00:00">2025-10-26</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="workboard"><img class="workSituationImg boardsign" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.0.4/img/badge/安知鱼-上班摸鱼中.svg" alt="距离月入25k也就还差一个大佬带我~" title="距离月入25k也就还差一个大佬带我~"/><div id="runtimeTextTip"></div></div></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2025 By <a class="footer-bar-link" href="/" title="野菜" target="_blank">野菜</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">28</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">25</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">12</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://wjt03.top/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size: 0.9em;"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 小空调</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AJAX/" style="font-size: 0.88rem;">AJAX<sup>1</sup></a><a href="/tags/Axios/" style="font-size: 0.88rem;">Axios<sup>1</sup></a><a href="/tags/CSS/" style="font-size: 0.88rem;">CSS<sup>1</sup></a><a href="/tags/Git/" style="font-size: 0.88rem;">Git<sup>1</sup></a><a href="/tags/HTML/" style="font-size: 0.88rem;">HTML<sup>1</sup></a><a href="/tags/MySQL/" style="font-size: 0.88rem;">MySQL<sup>1</sup></a><a href="/tags/Node-js/" style="font-size: 0.88rem;">Node.js<sup>1</sup></a><a href="/tags/React/" style="font-size: 0.88rem;">React<sup>1</sup></a><a href="/tags/TypeScript/" style="font-size: 0.88rem;">TypeScript<sup>1</sup></a><a href="/tags/Vue/" style="font-size: 0.88rem;">Vue<sup>3</sup></a><a href="/tags/Vue3/" style="font-size: 0.88rem;">Vue3<sup>1</sup></a><a href="/tags/canvas/" style="font-size: 0.88rem;">canvas<sup>1</sup></a><a href="/tags/host/" style="font-size: 0.88rem;">host<sup>1</sup></a><a href="/tags/js/" style="font-size: 0.88rem;">js<sup>3</sup></a><a href="/tags/this/" style="font-size: 0.88rem;">this<sup>1</sup></a><a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 0.88rem;">前端<sup>3</sup></a><a href="/tags/%E5%8D%9A%E5%AE%A2/" style="font-size: 0.88rem;">博客<sup>1</sup></a><a href="/tags/%E6%8C%87%E4%BB%A4/" style="font-size: 0.88rem;">指令<sup>1</sup></a><a href="/tags/%E6%95%99%E7%A8%8B/" style="font-size: 0.88rem;">教程<sup>1</sup></a><a href="/tags/%E6%A1%86%E6%9E%B6/" style="font-size: 0.88rem;">框架<sup>1</sup></a><a href="/tags/%E7%AC%94%E8%AE%B0/" style="font-size: 0.88rem;">笔记<sup>3</sup></a><a href="/tags/%E7%B3%BB%E7%BB%9F/" style="font-size: 0.88rem;">系统<sup>4</sup></a><a href="/tags/%E7%BC%96%E7%A8%8B/" style="font-size: 0.88rem;">编程<sup>12</sup></a><a href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" style="font-size: 0.88rem;">面试题<sup>1</sup></a><a href="/tags/%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/" style="font-size: 0.88rem;">项目总结<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="14379744963" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 野菜 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script async="async">(function () {
  var grt = new Date("04/01/2021 00:00:00"); //设置网站上线时间
  var now = new Date();
  var dnum;
  var hnum;
  var mnum;
  var snum;
  var nowHour;

  // 计算并更新天数、小时数、分钟数和秒数
  function updateTime() {
    now = new Date(); // 更新 now 的值
    nowHour = now.getHours(); // 更新 nowHour 的值
    var days = (now - grt) / 1000 / 60 / 60 / 24;
    dnum = Math.floor(days);
    var hours = (now - grt) / 1000 / 60 / 60 - 24 * dnum;
    hnum = Math.floor(hours);
    if (String(hnum).length == 1) {
      hnum = "0" + hnum;
    }
    var minutes = (now - grt) / 1000 / 60 - 24 * 60 * dnum - 60 * hnum;
    mnum = Math.floor(minutes);
    if (String(mnum).length == 1) {
      mnum = "0" + mnum;
    }
    var seconds = (now - grt) / 1000 - 24 * 60 * 60 * dnum - 60 * 60 * hnum - 60 * mnum;
    snum = Math.round(seconds);
    if (String(snum).length == 1) {
      snum = "0" + snum;
    }
  }

  // 更新网页中显示的网站运行时间
  function updateHtml() {
    const footer = document.getElementById("footer");
    if (!footer) return
    let currentTimeHtml = "";
    if (nowHour < 18 && nowHour >= 9) {
      // 如果是上班时间，默认就是"安知鱼-上班摸鱼中.svg"图片，不需要更改
      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    } else {
      // 如果是下班时间，插入"安知鱼-下班啦.svg"图片
      let img = document.querySelector("#workboard .workSituationImg");
      if (img != null) {
        img.src = "https://npm.elemecdn.com/anzhiyu-blog@2.0.4/img/badge/安知鱼-下班啦.svg";
        img.title = "下班了就该开开心心的玩耍，嘿嘿~";
        img.alt = "下班了就该开开心心的玩耍，嘿嘿~";
      }

      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    }

    if (document.getElementById("runtimeTextTip")) {
      document.getElementById("runtimeTextTip").innerHTML = currentTimeHtml;
    }
  }

  setInterval(() => {
    updateTime();
    updateHtml();
  }, 1000);
})();</script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>